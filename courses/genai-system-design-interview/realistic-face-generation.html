<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic Face Generation - Genai System Design Interview</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Open Sans', Arial, sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color: #454545;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

h1 {
    font-size: 2em;
    margin: 1em 0 0.5em 0;
    line-height: 1.2;
}

h2 {
    font-size: 1.5em;
    margin: 1.2em 0 0.6em 0;
    line-height: 1.3;
}

h3 {
    font-size: 1.2em;
    margin: 1em 0 0.5em 0;
    line-height: 1.4;
}

p {
    margin: 0.8em 0;
}

a {
    color: #0077aa;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

ul, ol {
    margin: 0.8em 0;
    padding-left: 2em;
}

li {
    margin: 0.4em 0;
}

code, pre {
    background: #f4f4f4;
    border: 1px solid #ddd;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}

code {
    padding: 2px 5px;
}

pre {
    padding: 10px;
    overflow-x: auto;
    margin: 1em 0;
}

pre code {
    border: none;
    padding: 0;
}

img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 1.5em auto;
}

figure {
    margin: 1.5em 0;
    text-align: center;
}

figcaption {
    font-style: italic;
    font-size: 0.9em;
    color: #666;
    margin-top: 0.5em;
}

.chapter-number {
    font-weight: bold;
    color: #0077aa;
}

.nav {
    margin: 2em 0;
    padding: 1em 0;
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
}

.nav a {
    margin-right: 1em;
}

.toc {
    list-style: none;
    padding: 0;
}

.toc li {
    margin: 0.8em 0;
}

.course-section {
    margin: 2em 0;
}

.course-title {
    font-size: 1.3em;
    font-weight: bold;
    color: #0077aa;
    margin: 1.5em 0 0.8em 0;
}

.metadata {
    font-size: 0.9em;
    color: #888;
    margin: 2em 0 1em 0;
}

.breadcrumb {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 1em;
}

.breadcrumb a {
    color: #0077aa;
}

@media (max-width: 600px) {
    body {
        padding: 10px;
    }

    h1 {
        font-size: 1.5em;
    }

    h2 {
        font-size: 1.3em;
    }
}</style>
</head>
<body>
    <div class="breadcrumb">
        <a href="../../index.html">Home</a> /
        <a href="../genai-system-design-interview.html">Genai System Design Interview</a> /
        Realistic Face Generation
    </div>

    <div class="nav">
        <a href="../genai-system-design-interview.html">← Course Contents</a>
        <a href="retrieval-augmented-generation.html">← Previous</a>
        <a href="high-resolution-image-synthesis.html">Next →</a>
    </div>

    <main>
        <h1>
            <span class="chapter-number">07</span> Realistic Face Generation
        </h1>

        <div class="metadata">
            <a href="https://bytebytego.com/courses/genai-system-design-interview/realistic-face-generation" target="_blank" rel="noopener">Original source</a>
        </div>

        <article>
            <header><strong class="style_chapter__grtAe">07</strong><h1>Realistic Face Generation</h1></header><h2 id="introduction">Introduction</h2>
<p>One of the primary applications of generative AI is to generate realistic images of faces. This can be useful in entertainment, marketing, and virtual reality. In this chapter, we explore the technologies behind face generation.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a horizontal arrangement of four headshots, each depicting a different individual.  The images are presented side-by-side, with no visible connections or information flow between them.  From left to right, the first headshot shows a dark-haired man with a serious expression, wearing a dark-colored shirt. The second shows a woman with shoulder-length brown hair, wearing glasses, and smiling. The third shows a young woman with long dark hair, wearing a red shirt, and exhibiting a neutral expression. The fourth headshot depicts a man with graying hair and a goatee, wearing a dark suit and light blue shirt, with a slightly smiling expression.  There are no labels, text, URLs, or parameters associated with any of the images or their arrangement.  The images appear to be simply a collection of individual portraits." loading="lazy" width="746" height="197" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(746px, 100vw), (max-width: 1200px) min(746px, 80vw), min(746px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-1-24AIFKRL.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 1: Realistic faces generated by StyleGAN2 [1]</figcaption></div></figure>
<h2 id="clarifying-requirements">Clarifying Requirements</h2>
<p>Here is a typical interaction between a candidate and an interviewer:</p>
<p><strong>Candidate</strong>: What is the primary application of the face generation system?<br>
<strong>Interviewer</strong>: The initial focus is on entertainment and content creation, but we would also consider using it for data collection in the future.</p>
<p><strong>Candidate</strong>: Is the focus only on faces? Or does the entire body need to be generated?<br>
<strong>Interviewer</strong>: Let’s focus on faces only.</p>
<p><strong>Candidate</strong>: Should the generated faces represent a diverse range of ethnicities, ages, and genders?<br>
<strong>Interviewer</strong>: Yes. This is crucial to ensure inclusivity and avoid biases.</p>
<p><strong>Candidate</strong>: Should the system allow control over facial attributes? For example, editing the facial expression of a generated image while preserving its identity?<br>
<strong>Interviewer</strong>: Good question. Let’s start without attribute control. If we have time, we can optionally discuss attribute control.</p>
<p><strong>Candidate</strong>: How will we source the training data? What is the size of the training data?<br>
<strong>Interviewer</strong>: We use publicly available datasets with proper licenses to ensure all data is in compliance with privacy regulations. There are 70,000 images of diverse faces in the dataset.</p>
<p><strong>Candidate</strong>: What is the desired image resolution?<br>
<strong>Interviewer</strong>: Let’s aim for 1024x1024.</p>
<p><strong>Candidate</strong>: What is the expected speed to generate a face?<br>
<strong>Interviewer</strong>: The system should generate faces in near real-time – less than a second.</p>
<h2 id="frame-the-problem-as-an-ml-task">Frame the Problem as an ML Task</h2>
<h3 id="specifying-the-systems-input-and-output">Specifying the system’s input and output</h3>
<p>In a face generation system, users usually don't provide specific inputs; they simply request the generation of a new face. Since machine learning (ML) models need numerical inputs to start, most image generation models begin with a random noise vector. This noise serves as the initial input, which the model then transforms into a realistic image. If the system supports attribute control, users can also provide desired attributes as input to guide the generation.</p>
<p>The output, which is generated in response to the random noise input, is a realistic image of a human face. This output should also reflect the desired attributes (if specified), such as age, gender, and hairstyle.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simplified data flow diagram illustrating a generative model, possibly for image generation.  A user request (indicated by 'User requesti...') enters the system from the left and flows into a larger, light orange rectangle. Inside this rectangle, a smaller, light purple oval labeled 'Random Noise...' represents the initial random input to the model.  The orange rectangle also contains the text 'Face...', suggesting the model is generating a face image.  A black arrow connects the 'Random Noise...' oval to the 'Face...' text, indicating the processing of the random noise.  Finally, a black arrow extends from the right side of the orange rectangle to a plain white square, representing the output of the model—likely the generated face image.  The overall flow shows a user request initiating the generation process, using random noise as input, within a larger processing block, ultimately resulting in an output image." loading="lazy" width="462" height="101" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-2-5W7KLXOS.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 2: Input and output of a face generation system</figcaption></div></figure>
<h3 id="choosing-a-suitable-ml-approach">Choosing a suitable ML approach</h3>
<p>In this section, we explore common ML approaches for image generation. We discuss the strengths and limitations of each approach and select the best fit for our use case.</p>
<p>While there are different approaches for generating images, we focus on those that are most widely used in the industry. There are four main approaches to image generation:</p>
<ul>
<li>Variational autoencoder</li>
<li>Generative adversarial network</li>
<li>Autoregressive model</li>
<li>Diffusion model</li>
</ul>
<h4 id="variational-autoencoder">Variational autoencoder</h4>
<p>A variational autoencoder (VAE) is a generative model architecture designed to learn the distribution of data. This enables the VAE to generate new data points by sampling from this learned distribution.</p>
<p>A VAE consists of two main components:</p>
<ul>
<li>Encoder</li>
<li>Decoder</li>
</ul>
<p><strong>Encoder:</strong> The encoder is a neural network that maps an input image into a lower-dimensional space, known as the latent space. The output of the encoder is a latent vector, an encoded representation of the input image.</p>
<p><strong>Decoder:</strong> The decoder is another neural network that maps the encoded representation into an image. The output of the decoder is an image of the same size as the original input image.</p>
<p>During training, the VAE encodes the input into a latent space and then reconstructs the original input from this encoded representation. After training, the VAE can generate new images by sampling points from the learned multivariate Gaussian distribution and using the decoder to map these points into image form.</p>
<p>Through a reparameterization trick (see [2] for more details), VAEs model the latent vector as being sampled from a multivariate Gaussian distribution. The modeling of latent space helps the VAE learn meaningful representations that can be smoothly interpolated, which is advantageous for tasks such as image morphing and creating variations of input data.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the training and inference phases of a Variational Autoencoder (VAE).  The top section, labeled 'VAE training,' shows an input 'Image' (light blue rectangle) feeding into an 'Encoder' (orange rectangle). The encoder's output, a latent vector representation, is then passed to a 'Decoder' (light green rectangle), which reconstructs the image (light blue rectangle labeled 'Reconstru...'). The bottom section, 'VAE inference,' depicts the inference process. Here, the encoder is crossed out, indicating it's not used. Instead, a 'Random vector...' (text below a vertical rectangle representing the latent space) sampled from a 'multivariate Gaussian' (text at the bottom left) is fed directly into the 'Decoder' (light green rectangle).  The decoder then generates a new 'Generated...' image (light red rectangle).  The dashed lines delineate the two distinct phases, highlighting the difference between using an input image for training and using a random vector for generating new images during inference." loading="lazy" width="476" height="404" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-3-OB4UKBNO.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 3: VAE training and inference process</figcaption></div></figure>
<p>VAEs have several strengths and weaknesses.</p>
<h5 id="pros">Pros:</h5>
<ul>
<li><strong>Simple architecture:</strong> The encoder and decoder are neural network architectures that are simple to implement.</li>
<li><strong>Fast generation:</strong> Compared to other approaches, VAEs offer fast image generation. The process involves sampling a random noise from the latent space and decoding it into an image using the decoder.</li>
<li><strong>Stable training:</strong> Training a VAE is typically easy and stable.</li>
<li><strong>Compression capability:</strong> Apart from image generation, VAEs are a powerful tool for compressing images into lower-dimensional representations.</li>
</ul>
<h5 id="cons">Cons:</h5>
<ul>
<li><strong>Less realistic images:</strong> VAEs struggle to capture high-frequency details. This leads to images that are less realistic compared to those generated by some other approaches.</li>
<li><strong>Blurriness:</strong> A significant limitation of VAEs is their tendency to produce blurry images that lack sharp details.</li>
<li><strong>Limited novelty:</strong> VAEs typically struggle to generate images that significantly differ from their training data. This limits their ability to produce novel outputs.</li>
<li><strong>Limited control in generation:</strong> VAEs are not designed to support extra control inputs such as text descriptions or attribute controls for the desired image.</li>
</ul>
<p>In summary, VAEs are not the best choice for generating high-quality, detailed images. Their strength, however, lies in efficiently encoding images into compact representations. In Chapter 11, we will explore VAEs and leverage their compression capabilities to build an efficient video generation system.</p>
<h4 id="generative-adversarial-network">Generative adversarial network</h4>
<p>A generative adversarial network (GAN) [3] consists of two networks:</p>
<ul>
<li><strong>Generator:</strong> A neural network that converts a random noise into an image.</li>
<li><strong>Discriminator:</strong> Another neural network that determines whether a given image is real or artificially generated.</li>
</ul>
<p>During training, these two networks engage in a continuous game: the generator learns to make more realistic images, while the discriminator becomes better at distinguishing real from generated ones. If a generated image is correctly classified as “generated,” the generator will receive a penalty for not generating a realistic image. This adversarial process continues until the generator generates images that the discriminator can no longer differentiate from real ones.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the training and inference phases of a Generative Adversarial Network (GAN).  The top section, labeled 'GAN training,' shows a data flow:  random vectors ('Random ve...') are fed into a 'Generator' (green box), which produces a 'Generated...' image (light red box). This generated image and a 'Real image' (light blue box) are both fed into a 'Discriminator' (orange box), which outputs classifications 'Fake' and 'Real,' respectively.  The discriminator's output is used to train both the generator and the discriminator. The bottom section, labeled 'GAN inference,' shows only the generator (green box) and the process of generating an image ('Generated...') from random vectors ('Random ve...'). The discriminator (grey box with an 'X' through it) is absent, indicating that during inference, only the generator is used to produce new images; the discriminator is not involved in the generation process.  Arrows indicate the direction of data flow between components." loading="lazy" width="514" height="405" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-4-LEX53CVM.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 4: GAN training and inference process</figcaption></div></figure>
<h5 id="pros-1">Pros:</h5>
<ul>
<li><strong>High-quality generation:</strong> GANs are known for their ability to generate high-quality images.</li>
<li><strong>Fast generation:</strong> While GANs are generally slower than VAEs, the generator can still generate an image in a single forward pass.</li>
<li><strong>Attribute control:</strong> GAN architecture can be modified to control specific attributes such as age or expression. For example, a user can request a face image that is happy and old.</li>
</ul>
<h5 id="cons-1">Cons:</h5>
<ul>
<li><strong>Training instability:</strong> GANs are challenging to train. Common training issues are mode collapse [4], where the generator creates a limited variety of outputs, and non-convergence [5], where the GAN model fails to stabilize during training.</li>
<li><strong>Limited control</strong>: While GANs allow for attribute control, it is challenging to go beyond that, for example, using a text description to generate an image [6].</li>
<li><strong>Limited novelty:</strong> While GANs are good at generating variations of images in a certain domain, they typically struggle to generate novel images that are much different from their training data.</li>
</ul>
<p>In summary, GANs are challenging to train, and they offer limited control over generated images. However, they can generate detailed images, and they support control over facial attributes, which makes them suitable for applications such as face generation and image editing.</p>
<h4 id="autoregressive-model">Autoregressive model</h4>
<p>In autoregressive modeling, image generation is formulated as a sequence generation task, where each part of an image is generated sequentially. This sequential generation enables the use of the Transformer architecture, allowing us to benefit from its powerful ability to capture long-range dependencies.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the training and inference processes of an autoregressive model, likely for image generation.  The left side depicts autoregressive training.  A 'Real image' (represented by a light blue square) is first 'Convert to sequence' (indicated by an arrow), resulting in a sequence of numbers (1 2 3 4 5 6 7 8 9) representing the image's features. This sequence is fed into a 'Transformer' (a large, light orange rectangle), which processes it and outputs a shifted sequence (2 3 4 5 6 7 8 9 .), where '.' likely represents an end token. The right side shows autoregressive inference.  The process begins with a 'random seed...' (indicated by a dashed arrow), which is fed into the 'Transformer' (another large, light orange rectangle). The Transformer outputs a sequence of image features (represented by smaller light blue squares), which are then 'Convert back to image' (indicated by arrows), resulting in a 'Generated...' image (a light pink square).  The inference process continues until an 'end token' is generated, signaling the completion of the image.  Both training and inference utilize a Transformer as the core processing unit, highlighting the model's autoregressive nature where the output of one step becomes the input for the next." loading="lazy" width="628" height="476" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-5-IZJ7I5AB.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5: Autoregressive model training and inference process</figcaption></div></figure>
<h5 id="pros-2">Pros:</h5>
<ul>
<li><strong>High detail and realism:</strong> Autoregressive models generate images with high levels of detail and sharpness.</li>
<li><strong>Stable training:</strong> Compared to GANs, training autoregressive models is usually more stable.</li>
<li><strong>Control over generation:</strong> It is possible to control image generation using additional inputs, such as a text prompt describing the desired image content. This flexibility comes from the Transformer architecture, which can support any number of inputs as part of the input sequence.</li>
<li><strong>Support of multimodal conditioning:</strong> Autoregressive models easily support conditioning on different modalities. For example, if we provide a celebration audio as input, the generated image will match the audio. This flexibility is due to the Transformer architecture, which can support different modalities as input as long as they are provided as a sequence of numerical vectors.</li>
<li><strong>Novelty:</strong> Autoregressive models are capable of generating novel and complex images. For example, they can generate an image of “an avocado on a chair on Mars” even if they haven't seen such examples in their training data.</li>
</ul>
<h5 id="cons-2">Cons:</h5>
<ul>
<li><strong>Slow generation:</strong> Autoregressive models generate the image sequentially, one token at a time. This sequential generation makes them slower compared to VAEs or GANs.</li>
<li><strong>Resource-intensive:</strong> These models are usually very large, with billions of parameters. Training such large models requires significant computational resources, which increases the cost.</li>
<li><strong>Limited image manipulation:</strong> Unlike VAEs and GANs, autoregressive models don’t have a structured latent space that can be easily explored or manipulated. This limits certain types of image manipulations such as attribute control in faces.</li>
</ul>
<p>In summary, while autoregressive models are slow in generation due to their sequential nature, they can generate highly detailed and novel images. Many popular image generation models, such as OpenAI’s DALL-E [7] and Google’s Muse [8], are based on autoregressive modeling. Chapter 8 will examine this approach in more detail.</p>
<h4 id="diffusion-model">Diffusion model</h4>
<p>Diffusion models are another popular approach for image generation, which has shown remarkable capabilities. Diffusion models formulate image generation as an iterative process. During training, noise is gradually added to images, and a neural network is trained to predict this noise. When generating images during inference, the process begins with random noise. The trained neural network is then used to iteratively denoise the image, transforming the noise into a meaningful image. This transformation occurs over a fixed number of steps, with the model adding details to the image at each step.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the training and inference phases of a diffusion model, likely for image generation.  The top section, labeled 'Diffusion training,' shows the process of adding noise to an original image iteratively until it becomes pure noise.  This is depicted by a sequence of images transitioning from a clear headshot to increasingly noisy versions, with arrows indicating the flow.  The label 'Adding noise' and ellipses (...) represent the iterative nature of the noise addition. The bottom section, 'Diffusion inference,' reverses this process.  It starts with an initial noisy image (labeled 'Initial...') and uses multiple 'Diffusion...' blocks (representing iterations of the diffusion model) to iteratively remove noise, progressively reconstructing a clearer image. The middle section, labeled 'Iteratively removing no...', shows the training process of reconstructing the original image from the noisy version using multiple 'Diffusion...' blocks, demonstrating the model learning to reverse the noise addition.  The final output in the inference phase is a generated image, different from the original image in the training phase, suggesting the model's ability to generate new images based on the learned noise removal process.  The arrows consistently indicate the direction of information flow (noise addition or removal) between the images and the diffusion model blocks." loading="lazy" width="676" height="456" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-6-CUNKQCHC.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 6: Diffusion model training and inference process</figcaption></div></figure>
<h5 id="pros-3">Pros:</h5>
<ul>
<li><strong>High detail and realism:</strong> Diffusion models can generate images of exceptional quality and realism.</li>
<li><strong>Stable training:</strong> Compared to GANs, training diffusion models are typically stable.</li>
<li><strong>Control over generation:</strong> Similar to autoregressive models, diffusion models can be controlled using various inputs, such as text describing the desired image.</li>
<li><strong>Novelty and creativity:</strong> Diffusion models can generate novel and imaginative images.</li>
<li><strong>Robustness to noisy images:</strong> Diffusion models are effective at removing noise from images because of their denoising process. This can be useful in certain applications such as image denoising.</li>
</ul>
<h5 id="cons-3">Cons:</h5>
<ul>
<li><strong>Slow generation:</strong> Diffusion models generate images in multiple denoising steps. This iterative process makes them slower compared to other methods.</li>
<li><strong>Resource-intensive:</strong> Diffusion models are usually large, with billions of parameters. This makes them computationally intensive and, therefore, expensive to train.</li>
<li><strong>Limited image manipulation:</strong> Unlike VAEs and GANs, diffusion models don’t have a structured latent space for manipulating images.</li>
</ul>
<p>In summary, while diffusion models are slow, they have shown impressive performance in generating highly detailed, diverse, and imaginative images. Most state-of-the-art image generation models, such as DALL·E 3 [9], are based on diffusion models. Chapter 9 will examine diffusion models in great detail.</p>
<div class="table-wrap" style="--table-min-width: 640px;"><table><thead><tr><th style="text-align: center;">Characteristics</th><th style="text-align: center;">VAE</th><th style="text-align: center;">GAN</th><th style="text-align: center;">Autoregressive</th><th style="text-align: center;">Diffusion</th></tr></thead><tbody><tr><td style="text-align: center;"><strong>Quality</strong></td><td style="text-align: center;">Low</td><td style="text-align: center;">Moderate</td><td style="text-align: center;">High</td><td style="text-align: center;">Exceptional</td></tr><tr><td style="text-align: center;"><strong>Speed</strong></td><td style="text-align: center;">Fast</td><td style="text-align: center;">Fast</td><td style="text-align: center;">Slow</td><td style="text-align: center;">Slow</td></tr><tr><td style="text-align: center;"><strong>Training stability</strong></td><td style="text-align: center;">Stable</td><td style="text-align: center;">Unstable</td><td style="text-align: center;">Stable</td><td style="text-align: center;">Stable</td></tr><tr><td style="text-align: center;"><strong>Control over generation</strong></td><td style="text-align: center;">Limited</td><td style="text-align: center;">Limited</td><td style="text-align: center;">Flexible</td><td style="text-align: center;">Moderate</td></tr><tr><td style="text-align: center;"><strong>Facial manipulation</strong></td><td style="text-align: center;">No</td><td style="text-align: center;">Yes</td><td style="text-align: center;">No</td><td style="text-align: center;">No</td></tr><tr><td style="text-align: center;"><strong>Novelty</strong></td><td style="text-align: center;">Limited</td><td style="text-align: center;">Limited</td><td style="text-align: center;">High</td><td style="text-align: center;">High</td></tr><tr><td style="text-align: center;"><strong>Resource intensity</strong></td><td style="text-align: center;">Moderate</td><td style="text-align: center;">Moderate</td><td style="text-align: center;">High</td><td style="text-align: center;">High</td></tr></tbody></table></div>
<p class="tableCaption"><p>Table 1: A comparison of different image generation approaches</p></p>
<p>For realistic face generation, we select GANs as our primary approach. GANs are particularly effective because they let us manipulate facial attributes through a structured latent space, which is an optional requirement in this chapter.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simple diagram illustrating the effect of different hair styles on a person's appearance.  The diagram features a central node with two branches.  On the left, a photograph shows a young man with medium-length, slightly tousled brown hair. From this central image, two horizontal lines extend to the right. The top line is labeled 'Bald hair' and points to a photograph of the same man, but with his head shaved, showing a bald scalp. The bottom line is labeled 'Slicked-back...' and points to a photograph of the same man again, this time with his hair neatly combed back and styled. The arrangement clearly shows the transformation of the individual's appearance based on the alteration of his hairstyle, with the original image serving as the base for comparison." loading="lazy" width="408" height="304" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-7-EYDFBGFY.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 7: Facial attribute manipulation. Images are taken from [10].</figcaption></div></figure>
<h2 id="data-preparation">Data Preparation</h2>
<p>Developing a realistic face generation system requires a large collection of images. Here, we have 70,000 diverse images of human faces. To prepare these images for training, we apply the following steps:</p>
<ul>
<li><strong>Remove low-quality or low-resolution images:</strong> We remove low-resolution images and use ML models to filter low-quality, blurry ones. This ensures the model learns only from high-quality images.</li>
<li><strong>Augment images:</strong> We apply data augmentation techniques such as flipping, rotation, or color adjustment to artificially increase the size of the training data. This helps the model see more variations of the image during training and, thus, generalize better afterward.</li>
<li><strong>Normalize and resize images:</strong> We resize all images to a standard dimension, for example, 1024x1024. We also normalize images to a standard range, typically between -1 and 1.</li>
<li><strong>Enhance diversity</strong>: We use ML classifiers to tag images with gender, age, and other attributes. Then, we adjust the dataset to ensure a balanced representation of different groups. This step is crucial to prevent biases in generated faces.</li>
</ul>
<h2 id="model-development">Model Development</h2>
<h3 id="architecture">Architecture</h3>
<p>GANs consist of two components: a generator and a discriminator. Let’s briefly examine the architecture of each component.</p>
<h4 id="generator">Generator</h4>
<p>The generator component takes random noise as input and converts it into an image. Its architecture consists of a series of upsampling blocks, each of which increases the spatial dimensions (height and width) of its input. These blocks gradually transform the low-dimensional noise vector into a 2D image of the desired size.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a generative model architecture, likely for image generation.  The process begins with a 'Noise vector' of size 100, represented as a vertical stack of 100 units. This vector is then reshaped into a 1x1x100 tensor. This tensor is fed into a series of five 'Upsampling B...' blocks. Each upsampling block increases the spatial dimensions of the input tensor while reducing the number of channels.  The first block receives the 1x1x100 tensor and outputs a 4x4x1024 tensor.  Subsequent blocks progressively increase the dimensions to 8x8x512, 16x16x256, 32x32x128, and finally 64x64x3.  The output of the final upsampling block, a 64x64x3 tensor, represents the generated image, labeled 'Output...'.  The dimensions of each tensor are explicitly shown above each corresponding block, indicating the height, width, and channel count.  Arrows indicate the flow of information between blocks." loading="lazy" width="610" height="170" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-8-WPD22TVE.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 8: Series of upsampling blocks</figcaption></div></figure>
<p>Let’s talk about the three main components of the upsampling block:</p>
<ul>
<li>Transposed convolution</li>
<li>Normalization layer</li>
<li>Non-linear activation</li>
</ul>
<h5 id="transposed-convolution">Transposed convolution</h5>
<p>Transposed convolution, also known as <em>deconvolution</em> or <em>upsampling convolution</em>, is an operation used in neural networks to increase the spatial resolution of feature maps—essentially performing the opposite of a regular convolution. It’s widely used in applications such as image generation, semantic segmentation, and super-resolution where the goal is to reconstruct higher-resolution outputs from lower-resolution inputs.</p>
<p>Unlike standard convolution, which slides a filter across the input, transposed convolution starts by inserting zeroes between the pixels of the input feature map, effectively expanding it. The expanded input is then convolved with a filter, where the filter’s stride<sup><a id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label" href="/courses/genai-system-design-interview/realistic-face-generation#user-content-fn-1">1</a></sup> and padding<sup><a id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/courses/genai-system-design-interview/realistic-face-generation#user-content-fn-2">2</a></sup> are adjusted to achieve the desired output size. For example, starting with an input of 1x1x100, with 1024 filters of kernel size 1x1 and stride 1, we end up with a 4x4x1024 feature map. In the next step, with 512 filters of kernel size 3x3 and stride 1, we get an 8x8x512 feature map. These are the first two upsampling stages shown in Figure 8.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a visual depiction of a 2D convolution operation, likely within a convolutional neural network (CNN).  The image shows four sequential steps. In each step, a smaller, teal-colored matrix (the kernel or filter) is overlaid on a larger, underlying matrix (the input feature map). The kernel is shown in various positions, sliding across the input feature map.  The kernel's elements are implicitly multiplied with the corresponding elements of the input feature map underneath. The result of this element-wise multiplication and summation (not explicitly shown) is a single value that contributes to the output feature map. The output feature map is represented by a smaller matrix below the input, with shaded squares indicating the areas being calculated in each step. The input feature map is represented by a larger grid with dashed lines, showing the full extent of the input. The darker shaded squares in the output matrix represent the accumulated results of the convolution operation as the kernel moves across the input. The process demonstrates how the kernel convolves across the input, producing a smaller output feature map that captures spatial features from the input." loading="lazy" width="708" height="207" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(708px, 100vw), (max-width: 1200px) min(708px, 80vw), min(708px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-9-V6JFIU6C.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 9: Transpose conv with 3x3 filter and *stride=1* over 4x4 inputs [11]</figcaption></div></figure>
<p>In PyTorch, this layer is usually implemented with “<em>ConvTranspose2d</em>.” To learn more about convolutions and transposed convolutions, refer to [11].</p>
<h5 id="normalization-layer">Normalization layer</h5>
<p>A normalization layer improves the training stability by scaling the input data to have a consistent distribution.</p>
<p>Training GANs is unstable because it involves two networks (the generator and the discriminator) competing against each other. This can lead to problems like mode collapse, where the generator produces limited diversity, or oscillations, where the generator and discriminator fail to converge during training. Normalization helps stabilize the training by scaling the activations at each layer, thus reducing the risk of vanishing or exploding gradients. This helps maintain consistent distributions of activations, which is critical for balanced competition between the generator and discriminator. With a more robust optimization process, we can use a higher learning rate, speed up training, and reduce the time needed for convergence. We will discuss the training challenges and mitigations later in this chapter.</p>
<p>There are several normalization layers, each with its own way of normalizing data:</p>
<ul>
<li>Batch normalization</li>
<li>Layer normalization</li>
<li>Instance normalization</li>
<li>Group normalization</li>
</ul>
<h6 id="batch-normalization-bn">Batch Normalization (BN)</h6>
<p>BN [12] normalizes the inputs of a layer across the batch dimension by calculating the mean and variance for each feature. The normalized data is then scaled and shifted using learnable parameters.</p>
<ul>
<li><strong>Benefits:</strong> BN helps stabilize the learning process and allows for higher learning rates, speeding up training. It also acts as a regularizer, reducing chances of overfitting.</li>
<li><strong>Usage:</strong> Commonly used in deep networks, including Convolutional Neural Networks (CNNs) and GAN generators.</li>
</ul>
<h6 id="layer-normalization-ln">Layer Normalization (LN)</h6>
<p>LN [13] normalizes the inputs across the features of each individual sample rather than across the batch dimension. It, therefore, computes the mean and variance for each feature across the entire feature vector of each sample.</p>
<ul>
<li><strong>Benefits:</strong> LN is effective in settings where batch sizes are small or variable, such as in Recurrent Neural Networks (RNNs) and Transformers.</li>
<li><strong>Usage:</strong> Frequently used in sequence models and scenarios where consistent behavior across samples is crucial.</li>
</ul>
<h6 id="instance-normalization-in">Instance Normalization (IN)</h6>
<p>IN [14] operates by normalizing across each feature map individually for each sample.</p>
<ul>
<li><strong>Benefits:</strong> IN is beneficial for tasks where the appearance of individual samples varies widely, as it allows the network to focus on content rather than style.</li>
<li><strong>Usage:</strong> Commonly used in style transfer and image generation tasks.</li>
</ul>
<h6 id="group-normalization-gn">Group Normalization (GN)</h6>
<p>GN [15] normalizes inputs by dividing features into groups and normalizing within each group. It offers a balance between BN and LN.</p>
<ul>
<li><strong>Benefits:</strong> GN is useful for cases with very small batch sizes where BN might not be effective.</li>
<li><strong>Usage:</strong> Often applied in tasks where BN fails due to small batch sizes or when layer behavior consistency is needed across groups of features.</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a comparison of four different normalization techniques (Batch Norm, Layer Norm, Instance Norm, and Group Norm) used in neural networks, visualized as 3D tensors. Each technique is depicted using a cube representing a feature map with dimensions H (height), W (width), and C (channels), where N represents the batch size.  The cubes are consistently oriented with H and W along the vertical and horizontal axes respectively, and C along the depth.  A dark blue section within each cube illustrates the portion of the tensor over which normalization is performed. In Batch Norm, normalization is across the entire batch (N) for each channel (C) at each spatial location (H, W). Layer Norm normalizes across the H, W dimensions for each channel and each sample in the batch. Instance Norm normalizes across H and W for each channel within a single sample. Finally, Group Norm divides the channels into groups and normalizes across H, W within each group for each sample.  The light gray portion of each cube represents the remaining data not included in the normalization calculation for that specific method." loading="lazy" width="705" height="213" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(705px, 100vw), (max-width: 1200px) min(705px, 80vw), min(705px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Ffigure-7-10-QIJRYXKR.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 10: Comparison of different normalization methods [15]</figcaption></div></figure>
<h5 id="non-linear-activation">Non-linear activation</h5>
<p>Non-linear activation functions, such as ReLU [16], introduce non-linearity into the model, allowing it to learn complex patterns and representations. Without non-linearity, the network would essentially be a linear transformation, regardless of the depth, making it incapable of modeling intricate data distributions such as images, speech, or complex functions.</p>
<p>As shown in Figure 11, our generator consists of upsampling blocks (ConvTranspose2D), each followed by a normalization layer (BatchNorm2D) and a non-linear activation (ReLU). The final block uses "Tanh" [17] instead of "ReLU". This choice ensures the final outputs range between -1 and 1, matching the range of our image pixels after data preparation.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a generative model architecture, likely a type of Generative Adversarial Network (GAN) or similar, depicted as a sequence of processing blocks.  The input is a 'Noise vector,' represented as a small stack of rectangles, which feeds into a series of three identical upsampling blocks. Each upsampling block consists of a 'ConvTranspose2d' layer (for upsampling), followed by a 'BatchNorm2D' layer (for normalization), and finally a 'ReLU' activation function.  These blocks are arranged sequentially, with the output of one block feeding into the input of the next.  An ellipsis ('...') indicates the potential for more identical upsampling blocks. The final block differs slightly, replacing the ReLU activation with a 'Tanh' activation function. The output of this final block is a 3x64x64 tensor, visualized as a three-dimensional rectangular prism with dimensions labeled.  The arrows indicate the flow of data through the network, from the noise vector to the final output tensor.  The text 'Upsampling...' below each block highlights the upsampling operation performed within each block." loading="lazy" width="600" height="209" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-11-RDUIUMD5.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 11: Generator architecture</figcaption></div></figure>
<h4 id="discriminator">Discriminator</h4>
<p>The discriminator's job is to differentiate between real and generated images. It functions as a binary classifier, taking an image as input and outputting the probability that the image is real.</p>
<p>The discriminator comprises a series of downsampling blocks followed by a classification head. The downsampling blocks progressively reduce the spatial dimensions of the input image while extracting its features. The classification head then processes the extracted features to predict the probability that the input image is real.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a convolutional neural network (CNN) architecture for image classification.  The process begins with an input 'Image' represented as a 3D tensor of dimensions 64x64x3 (height x width x channels). This image then passes through a series of four 'Downsampling...' blocks, each reducing the spatial dimensions of the tensor while increasing the number of channels.  The first downsampling block outputs a 32x32x128 tensor, the second a 16x16x256 tensor, the third an 8x8x512 tensor, and the fourth a 4x4x1024 tensor.  These downsampling operations likely involve convolutional layers and pooling layers to extract features from the image at different scales.  The output of the final downsampling block (4x4x1024) is then fed into a 'Classific...' block, which is likely a fully connected layer or a series of fully connected layers responsible for classifying the image into different categories. Finally, the 'Classific...' block outputs a 'Probability' value, representing the likelihood of the image belonging to a specific class.  Arrows indicate the flow of data between the different components." loading="lazy" width="624" height="167" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-12-IN6S4LCM.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 12: Series of downsampling blocks</figcaption></div></figure>
<p>A downsampling block consists of several convolution operations to progressively decrease the input's spatial dimension. In PyTorch, we typically use a "Conv2D" layer with a stride of 2 to halve the spatial dimensions. Like the generator, batch normalization (BatchNorm2D) and non-linear activation function (ReLU) are used in between convolution layers to enhance training stability and performance.</p>
<p>The classification head includes one or two fully connected layers followed by a <em>sigmoid</em> activation function. The <em>sigmoid</em> function ensures the final output ranges between 0 and 1, which is crucial for interpreting the output as a probability.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a convolutional neural network (CNN) architecture for image classification.  The input is a 64x64x3 image, depicted as a 3D cube with dimensions labeled. This image is fed into a series of two identical downsampling blocks (shown in pink), each consisting of a Conv2D layer, a BatchNorm2D layer, and a ReLU activation function.  Arrows indicate the flow of data between layers.  The output of the downsampling blocks is then passed to a classification block (shown in lavender) containing a Fully Connected layer followed by a Sigmoid activation function.  The ellipsis (...) between the downsampling blocks suggests the potential for repetition of this downsampling pattern. Finally, the output of the Sigmoid layer is a probability, represented by a small square labeled 'Probabili...', indicating the network's prediction for the image's class.  The labels 'Downsamplin...' and 'Classificat...' are truncated descriptions of the respective blocks' functions." loading="lazy" width="581" height="186" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-13-ZSK7GCGZ.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 13: Discriminator architecture</figcaption></div></figure>
<p>Various versions of GANs have been developed over the years to serve different purposes. For instance, StyleGAN [18] modifies the generator's architecture to control attributes of generated faces, such as age, hair color, and facial expression. For more details on the StyleGAN architecture and its key architectural choices, refer to [18].</p>
<h3 id="training">Training</h3>
<p>To produce realistic images, we train the GAN using a unique process called adversarial training. In adversarial training, the generator and the discriminator are trained simultaneously in a game-like scenario. The generator aims to produce images that look real, while the discriminator improves its ability to distinguish between real and generated images. During this adversarial process, the generator learns to produce increasingly more convincing images. At the same time, the discriminator gets better at identifying fake images. This competitive process continues until the generator produces images that the discriminator can no longer detect as fake.</p>
<p>When training GANs, it is important to ensure both the generator and discriminator improve together, avoiding scenarios where one dominates the other. Such a balance is empirically shown to be crucial for successful training. To maintain this balance, it is common to alternate between the following two steps:</p>
<ol>
<li>Train the discriminator for a few iterations while keeping the generator frozen.</li>
<li>Train the generator for a few iterations while keeping the discriminator frozen.</li>
</ol>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the training process of a Generative Adversarial Network (GAN).  The diagram is divided into two sections, separated by a dashed line.  The upper section, labeled '1 Training the discriminat...', depicts the training of the discriminator.  A 'Noise vector' is input into a 'Frozen...' component (presumably a pre-trained generator), which outputs a sample. This sample, along with samples from a 'Real...' dataset (represented as a cylinder), is fed into the 'Discriminator'. The discriminator outputs a 'Probability' indicating whether the input is real or generated. The lower section, labeled '2 Training the generator', shows the training of the generator.  A 'Noise vector' is input into the 'Generator', which produces a sample. This sample is then fed into a 'Frozen...' discriminator (the discriminator from the first step, now with fixed weights, indicated by a lock icon), which outputs a 'Probability'.  Both sections show the flow of data from the noise vector, through the generator or frozen generator, to the discriminator or frozen discriminator, and finally to a probability output.  The 'Real...' datasets in both sections represent real-world data used for training.  The lock icons indicate that the respective components are frozen during their respective training phases." loading="lazy" width="472" height="388" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-14-ZBWWGID6.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 14: Generator and discriminator alternative training</figcaption></div></figure>
<p>Next, let’s examine the ML objective and loss function for training a GAN model.</p>
<h4 id="ml-objective-and-loss-function">ML objective and loss function</h4>
<p>The generator and discriminator have their own specific, conflicting goals. The discriminator aims to distinguish accurately between real and generated images. The generator aims to produce images that the discriminator cannot distinguish from real ones. We first explore the loss function and ML objective of each component and then combine them into a unified loss function for the GAN.</p>
<h5 id="discriminator-1">Discriminator</h5>
<p>We employ binary cross-entropy as the loss function for the discriminator, as it is commonly used in binary classification models.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mi>D</mi></msub><mo>=</mo><mo>−</mo><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="0em"></mspace></mpadded><mspace width="-0.5em"></mspace><mover><mover><mrow><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mi>log</mi><mo>⁡</mo><mi>D</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow></mrow><mo stretchy="true">⏞</mo></mover><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>&nbsp;loss&nbsp;contribution&nbsp;</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>&nbsp;from&nbsp;real&nbsp;images&nbsp;</mtext></mstyle></mtd></mtr></mtable></mover><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="0em"></mspace></mpadded><mspace width="-0.4em"></mspace><mo>−</mo><mtext>&nbsp;</mtext><mover><mover><mrow><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mrow><mo fence="true">(</mo><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><mo stretchy="true">⏞</mo></mover><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>&nbsp;loss&nbsp;contribution&nbsp;</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>&nbsp;from&nbsp;fake&nbsp;images&nbsp;</mtext></mstyle></mtd></mtr></mtable></mover></mrow><annotation encoding="application/x-tex">L_D=-\hspace*{-5pt}\overbrace{\frac{1}{m} \sum_{i=1}^m \log D\left(\mathbf{x}^{(i)}\right)}^{\begin{array}{c}
		\text { loss contribution } \\
		\text { from real images }
\end{array}} \hspace*{-4pt}-~ \overbrace{\frac{1}{n} \sum_{j=1}^n \log \left(1-D\left(G\left(\mathbf{z}^{(j)}\right)\right)\right)}^{\begin{array}{c}
		\text { loss contribution } \\
		\text { from fake images }
\end{array}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">D</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 5.8061em; vertical-align: -1.4138em;"></span><span class="mord">−</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 0em; bottom: 0em;"></span><span class="mspace" style="margin-right: -0.5em;"></span><span class="mord mover"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 4.3923em;"><span style="top: -4.2994em;"><span class="pstrut" style="height: 4.2994em;"></span><span class="mord mover"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.2994em;"><span style="top: -3.6514em;"><span class="pstrut" style="height: 3.6514em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span><span class="svg-align" style="top: -5.4028em;"><span class="pstrut" style="height: 3.6514em;"></span><span class="stretchy" style="height: 0.548em; min-width: 1.6em;"><span class="brace-left" style="height: 0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z"></path></svg></span><span class="brace-center" style="height: 0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z"></path></svg></span><span class="brace-right" style="height: 0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z"></path></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span></span></span></span></span></span></span><span style="top: -7.5702em;"><span class="pstrut" style="height: 4.2994em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6021em;"><span style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord sizing reset-size3 size6"><span class="mord text"><span class="mord">&nbsp;loss&nbsp;contribution&nbsp;</span></span></span></span><span style="top: -2.2579em;"><span class="pstrut" style="height: 3em;"></span><span class="mord sizing reset-size3 size6"><span class="mord text"><span class="mord">&nbsp;from&nbsp;real&nbsp;images&nbsp;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.1021em;"><span></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span></span></span></span></span></span><span class="mord rule" style="border-right-width: 0em; border-top-width: 0em; bottom: 0em;"></span><span class="mspace" style="margin-right: -0.4em;"></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace nobreak">&nbsp;</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mover"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 4.3923em;"><span style="top: -4.2994em;"><span class="pstrut" style="height: 4.2994em;"></span><span class="mord mover"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.2994em;"><span style="top: -3.6514em;"><span class="pstrut" style="height: 3.6514em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span><span class="svg-align" style="top: -5.4028em;"><span class="pstrut" style="height: 3.6514em;"></span><span class="stretchy" style="height: 0.548em; min-width: 1.6em;"><span class="brace-left" style="height: 0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z"></path></svg></span><span class="brace-center" style="height: 0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z"></path></svg></span><span class="brace-right" style="height: 0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z"></path></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span></span><span style="top: -7.5702em;"><span class="pstrut" style="height: 4.2994em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6021em;"><span style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord sizing reset-size3 size6"><span class="mord text"><span class="mord">&nbsp;loss&nbsp;contribution&nbsp;</span></span></span></span><span style="top: -2.2579em;"><span class="pstrut" style="height: 3em;"></span><span class="mord sizing reset-size3 size6"><span class="mord text"><span class="mord">&nbsp;from&nbsp;fake&nbsp;images&nbsp;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.1021em;"><span></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span></span></span></span></span>
<p>Where:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mrow><mo fence="true">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">D\left(x^{(i)}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.238em; vertical-align: -0.35em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> is the discriminator's predicted probabilities for a real image,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">G\left(z^{(j)}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.238em; vertical-align: -0.35em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> is the generator's output (a fake image) given random noise,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> is the number of real images,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> is the number of fake images.</li>
</ul>
<p>The discriminator’s ML objective is to minimize the binary cross-entropy loss function.</p>
<h5 id="generator-1">Generator</h5>
<p>The generator aims to produce realistic images that the discriminator cannot distinguish from real ones. Ideally, the discriminator should predict probabilities close to 1 for images that have been produced by the generator. To achieve this, the ML objective is formulated as maximizing <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>D</mi><mrow><mo fence="true">(</mo><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log \left(D\left(G\left(z^{(j)}\right)\right)\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.238em; vertical-align: -0.35em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">(</span></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">(</span></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> for all fake images or, equivalently, minimizing the following loss function:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mi>G</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mrow><mo fence="true">(</mo><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">L_G=\frac{1}{n} \sum_{j=1}^n \log \left(1-D\left(G\left(\mathbf{z}^{(j)}\right)\right)\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.0652em; vertical-align: -1.4138em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>
<h5 id="gans-minimax-loss">GAN’s minimax loss</h5>
<p>The minimax loss [19], originally used in the GAN paper, unifies the generator’s and discriminator’s losses into a single function:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>&nbsp;Minimax&nbsp;loss&nbsp;</mtext><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mi>log</mi><mo>⁡</mo><mi>D</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo>+</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mrow><mo fence="true">(</mo><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text { Minimax loss }=\frac{1}{m} \sum_{i=1}^m \log D\left(\mathbf{x}^{(i)}\right)+\frac{1}{n} \sum_{j=1}^n \log \left(1-D\left(G\left(\mathbf{z}^{(j)}\right)\right)\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord text"><span class="mord">&nbsp;Minimax&nbsp;loss&nbsp;</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.9291em; vertical-align: -1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 3.0652em; vertical-align: -1.4138em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>
<p>The discriminator aims to maximize the loss, while the generator aims to minimize it. Therefore, the overall ML objective is:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mi>G</mi></munder><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi>D</mi></munder><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mi>log</mi><mo>⁡</mo><mi>D</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo>+</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mrow><mo fence="true">(</mo><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\min _G \max _D\left(\frac{1}{m} \sum_{i=1}^m \log D\left(\mathbf{x}^{(i)}\right)+\frac{1}{n} \sum_{j=1}^n \log \left(1-D\left(G\left(\mathbf{z}^{(j)}\right)\right)\right)\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.1638em; vertical-align: -1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.6679em;"><span style="top: -2.3557em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span><span style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7443em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.4306em;"><span style="top: -2.3557em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">D</span></span></span><span style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7443em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span></span></span></span></span>
<p>Besides the minimax loss, researchers have proposed other loss functions to improve training stability in GANs. To learn more about these loss functions, refer to [20].</p>
<h4 id="common-training-challenges-in-gans">Common training challenges in GANs</h4>
<p>GANs are difficult to train compared to other generative models such as autoregressive or diffusion models. Discussing these challenges is beneficial in an ML interview. In this section, we discuss three main challenges of training GANs:</p>
<ul>
<li>Vanishing gradients</li>
<li>Mode collapse</li>
<li>Failure to converge</li>
</ul>
<h5 id="vanishing-gradients">Vanishing gradients</h5>
<p>The vanishing gradient problem [21] occurs when gradients become very small during training. This problem primarily affects the generator. When the discriminator becomes too good at distinguishing between real and fake images, it provides very small gradient values for the generator to update its parameters. This slows down or stops the generator’s learning process.</p>
<p>Two common techniques to mitigate the vanishing gradient problem are:</p>
<ul>
<li>Modified minimax loss</li>
<li>Wasserstein loss</li>
</ul>
<p><strong>Modified minimax loss:</strong> The original GAN paper points out that minimizing the original ML objective can cause training to stall. To overcome this, the paper recommends altering the generator's objective to maximize</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mi>G</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>D</mi><mrow><mo fence="true">(</mo><mi>G</mi><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mrow><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">L_G=\frac{1}{n} \sum_{j=1}^n \log \left(D\left(G\left(\mathbf{z}^{(j)}\right)\right)\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.0652em; vertical-align: -1.4138em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>
<p>This minor adjustment is inspired by formulating the ML objective from a different
perspective. With this change, the generator aims to maximize the probability of
fake images being identified as real, rather than minimizing the probability of fake
images being identified as fake.</p>
<p><strong>Wasserstein loss:</strong> This loss function is used in a modified GAN called a "<em>Wasserstein GAN</em>" or "<em>WGAN</em>." Let’s examine the ML objective for a WGAN’s discriminator and generator.</p>
<ul>
<li><strong>WGAN’s discriminator:</strong> The discriminator for a WGAN, also known as the "critic," differs from the one in a traditional GAN. Instead of classifying images as real or fake, the critic outputs a score representing the "realness" of an image. The critic loss is defined as the difference between the critic’s outputs for real images and fake images. Hence, the critic’s ML objective is to maximize the critic loss.</li>
</ul>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>&nbsp;Critic&nbsp;loss&nbsp;</mtext><mo>=</mo><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>D</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text { Critic loss }=D(x)-D(G(z))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord text"><span class="mord">&nbsp;Critic&nbsp;loss&nbsp;</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mopen">(</span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.04398em;">z</span><span class="mclose">))</span></span></span></span></span>
<ul>
<li><strong>WGAN’s generator:</strong> The ML objective for the generator of a WGAN is to maximize the probability of fake images being identified as real:</li>
</ul>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>&nbsp;Generator&nbsp;loss&nbsp;:&nbsp;</mtext><mi>D</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text { Generator loss : } D(G(z))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">&nbsp;Generator&nbsp;loss&nbsp;:&nbsp;</span></span><span class="mord mathnormal" style="margin-right: 0.02778em;">D</span><span class="mopen">(</span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.04398em;">z</span><span class="mclose">))</span></span></span></span></span>
<h5 id="mode-collapse">Mode collapse</h5>
<p>Ideally, a GAN model should produce different variations of images with different random inputs. Mode collapse refers to situations where the generator produces a limited variety of images. Let’s see why this might happen.</p>
<p>During training, the generator might learn to trick the system by finding one image that seems most plausible to the discriminator. Once the generator finds this most plausible image, it may keep producing the same image to fool the discriminator. Hence, the generator never learns to generate other images. This type of failure in a GAN is known as “<em>mode collapse</em>”. Two common techniques to mitigate mode collapse are:</p>
<ul>
<li>Wasserstein loss</li>
<li>Unrolled GAN [22]</li>
</ul>
<p>To learn more about the unrolled GAN and how it mitigates the mode collapse, refer to [4].</p>
<h5 id="failure-to-converge">Failure to converge</h5>
<p>Training GANs is typically challenging and the process is often unstable. This is due to the “failure to converge” problem, a common issue in training GANs. Let’s explore why this happens.</p>
<p>As the generator improves during training, the discriminator's performance declines because it becomes increasingly more difficult to distinguish between real and fake images. If the generator reaches a point where it can mimic real data perfectly, the discriminator’s accuracy drops to 50 percent; it effectively begins to make random guesses, much like flipping a coin. This decline in discriminator performance hinders GAN convergence since its feedback gradually becomes less and less useful to the generator. When training continues past a certain point, the generator starts training on useless feedback, and its quality may collapse as a result.</p>
<p>There are various approaches to improve the training stability and convergence of GANs:</p>
<ul>
<li><strong>Normalization</strong>: Applying techniques like batch normalization helps stabilize training by ensuring consistent distributions across layers.</li>
<li><strong>Different learning rates</strong>: Using different learning rates for the generator and discriminator can help balance their progress and avoid instability in training.</li>
<li><strong>Regularization</strong>: Employing regularization methods like weight decay prevents overfitting and helps maintain training stability.</li>
<li><strong>Adding noise to discriminator inputs</strong>: Injecting noise into the inputs of the discriminator can prevent it from becoming too powerful early on, which helps balance the competition between the generator and the discriminator.</li>
</ul>
<p>To learn more about the specific details of these approaches, refer to [21] and [23].</p>
<h3 id="sampling">Sampling</h3>
<p>Sampling is the process of generating new images from a trained GAN model. Before discussing sampling methods, let's first review the concept of latent space in a GAN.</p>
<p>During training, the generator learns to transform various noise vectors into images. This process forms a latent space—a multidimensional space where each point represents a potential noise vector. This latent space is meaningful to the GAN because its generator can map each point to its corresponding image.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a latent space, depicted as an oval containing numerous dark gray dots, representing data points (likely encoded features of images).  Two red dots are positioned within this space, suggesting generated or manipulated data points.  Dashed arrows connect these red dots to images of faces positioned outside the oval. One arrow points from a red dot to an image of a man, and another arrow points from a second red dot to an image of a woman. The label 'Latent space' is placed above the oval, clearly identifying the area containing the data points. The arrangement visually suggests that the latent space encodes facial features, and the red dots represent generated or manipulated representations of faces in this space, with the arrows indicating the mapping between the latent space representation and the actual image." loading="lazy" width="308" height="260" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-15-2HEMNKFH.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 15: Latent space points map to face images</figcaption></div></figure>
<p>To generate a realistic face image, we sample a point from this latent space, known as a latent vector. The generator then takes this latent vector and transforms it into an image.</p>
<p>There are two methods to sample a latent vector from a learned latent space:</p>
<ul>
<li>Random sampling</li>
<li>Truncated sampling</li>
</ul>
<h4 id="random-sampling">Random sampling</h4>
<p>Random sampling uses a standard Gaussian distribution to draw latent vectors from the latent space. This ensures a diverse selection of latent vectors, leading to the generation of varied images.</p>
<h4 id="truncated-sampling">Truncated sampling</h4>
<p>Truncated sampling restricts the latent vectors to a smaller, high-probability region of the latent space. By truncating the distribution, the method reduces the chance of generating outliers, resulting in higher-quality images. This approach is beneficial when the primary goal is to maintain high realism in the generated faces. If you are interested in learning about the details and implementation of truncated sampling, refer to [24].</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a comparison of two sampling methods: random sampling and truncated sampling.  The image is divided into two halves by a dashed vertical line. The left half is titled 'Random sampling' and contains a single, large, light-grey circle filling most of the space. This circle visually represents the entire sample space, with all points equally likely to be selected. The right half is titled 'Truncated sampling' and shows a similar light-grey circle, but this circle contains three smaller, irregularly shaped, light-grey ellipses. These ellipses represent the selected samples, indicating that only certain regions within the sample space are considered, resulting in a non-uniform probability distribution. The text 'Text is not SVG &amp; cannot display' is present at the bottom center, likely indicating a limitation in rendering the image.  The overall arrangement clearly contrasts the uniform distribution of random sampling with the non-uniform, truncated distribution of the second method." loading="lazy" width="443" height="187" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-16-OU2TXXSZ.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 16: Random vs. truncated sampling (gray regions represent sampling areas).</figcaption></div></figure>
<p>In summary, random sampling ensures diversity by exploring the entire latent space, while truncated sampling focuses on a high-probability region to enhance realism. For realistic face generation, we utilize random sampling as it leads to diversity and usually works well in practice.</p>
<h2 id="evaluation">Evaluation</h2>
<h3 id="offline-evaluation-metrics">Offline evaluation metrics</h3>
<p>Evaluating image generation systems involves assessing both the quality and diversity of the generated images. Several metrics have been developed for this purpose, such as Inception score [25], Fréchet Inception distance (FID) [26], and Kernel Inception distance (KID) [27]. Among these, Inception score and FID are the most widely used. Human evaluation also continues to be an essential method of assessing generative models.</p>
<p>In an ML system design interview, the interviewer’s goal is to assess your intuition and practical understanding, rather than test your detailed knowledge of formulas and theories. However, having a broad understanding of some of these metrics can still be helpful. Let’s briefly examine the Inception score and FID.</p>
<h4 id="inception-score">Inception score</h4>
<p>The Inception score is a widely used metric to evaluate the quality of generated images in generative models such as GANs. The metric relies on a pretrained image classification model, such as “<em>Inception v3</em>” [28], to assess how well the generated images resemble real-world objects.</p>
<p>Here's a step-by-step explanation of how the metric is calculated:</p>
<ol>
<li><strong>Generating images:</strong> We start by generating a large set of images using the model we want to evaluate.</li>
<li><strong>Computing class probabilities:</strong> For each generated image, the Inception model provides a probability distribution over all of its 1,000 object classes. A high-quality image should lead to a distribution with a peak (i.e., a high probability for one class) indicating that the model recognizes it as a clear instance of a class.</li>
<li><strong>Calculating the marginal distribution:</strong> Marginal distribution refers to the average of the predicted class probabilities across all images. This helps us understand the overall distribution of classes represented in the generated set. If the images are diverse, the marginal distribution will be flat and spread across many classes.</li>
<li><strong>Computing KL divergence:</strong> The KL divergence measures how different the predicted class distribution for each image is from the marginal distribution. High-quality images will have a distribution that is very different from the marginal distribution. This is because a high-quality image is expected to have a peak in its distribution, while the marginal distribution is expected to be close to uniform if the images are diverse.</li>
<li><strong>Calculating the Inception score:</strong> The Inception score is the exponentiated average of the KL divergence across all images. A high Inception score indicates that individual images have been confidently classified into a variety of classes, which means the generated images are both diverse and of high quality.</li>
</ol>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a generative model evaluation pipeline.  It begins with a Generative Adversarial Network (GAN) (labeled 'GAN' in a green box, numbered '1') which outputs a series of data samples (represented by several light orange boxes within a dashed box). These samples are then fed into an 'Inception' model (labeled 'Inceptio...', numbered '2'), which processes them and produces a set of histograms representing the distribution of features.  These histograms are then compared to a 'Marginal distribution' (labeled 'Marginal d...', numbered '3'), also represented by histograms, using a Kullback-Leibler (KL) divergence metric (labeled 'KL-diverg...', numbered '4'). The KL divergence calculation results in a series of scores (represented by empty boxes next to KL divergence calculations), each score corresponding to a specific feature distribution comparison.  Finally, these scores are aggregated and fed into an 'Inception' model (labeled 'Incept...', numbered '5'), likely for further analysis or model refinement. The entire process visually depicts the evaluation of GAN-generated data by comparing its feature distribution to a reference distribution using KL divergence as a scoring mechanism." loading="lazy" width="629" height="485" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-17-IWXQTEKD.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 17: Inception score calculation</figcaption></div></figure>
<p><strong>How does the Inception score measure both diversity and quality?</strong></p>
<ul>
<li><strong>Diversity:</strong> The Inception score evaluates diversity by checking if the generated images result in a nearly uniform marginal distribution across classes, indicating that the images are spread evenly across different classes.</li>
<li><strong>Quality:</strong> High-quality images result in a sharp, peaked probability distribution, indicating that the image is clearly recognized as belonging to a particular class. The Inception score compares this distribution with the marginal distribution to assess image quality.</li>
</ul>
<h4 id="fréchet-inception-distance-fid">Fréchet inception distance (FID)</h4>
<p>FID is another popular metric for evaluating the quality of images produced by generative models. It assesses how similar the distribution of generated images is to the distribution of real images. Unlike the Inception score, which uses class probabilities, FID considers the statistics of the features extracted by a pretrained model such as <em>Inception v3</em>. The Inception model is chosen because it is trained on a large and diverse dataset (ImageNet) and can extract meaningful features that represent the content and style of the images.</p>
<p>Here's a step-by-step explanation of how FID is calculated:</p>
<ol>
<li><strong>Generating images:</strong> We start by generating a large set of images using the model we want to evaluate. These images will be compared to a set of real images to evaluate their quality and diversity.</li>
<li><strong>Extracting features:</strong> We pass each image (both generated and real) through the <em>Inception v3</em> model and extract features (“activations”) from a specific layer, usually one near the end of the network. Features from this deep layer capture high-level information—such as shapes, textures, and objects—which is crucial for assessing the realism of the images.</li>
<li><strong>Calculating mean and covariance:</strong> We calculate the mean and covariance of the extracted features separately for generated and real images. These statistical measures summarize the distributions of features for both sets of images.</li>
<li><strong>Computing Fréchet distance:</strong> We calculate the FID as the Fréchet distance between the mean and covariance of generated and real images. The Fréchet distance measures how close the two distributions are. A lower FID indicates greater similarity between the distributions, meaning the generated images are more realistic and diverse. To learn more about the Fréchet distance and its formula, refer to [29].</li>
</ol>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a flowchart illustrating the process of calculating the Fréchet Inception Distance (FID) score to evaluate the quality of images generated by a Generative Adversarial Network (GAN).  The process begins with a GAN (labeled 'GAN') which generates a set of 'Fake images' (represented by orange rectangles). These fake images are then fed (arrow labeled '1') into an Inception network (labeled 'Inceptio...').  Simultaneously, a set of 'Real images' (represented by green rectangles) are also fed into the same Inception network (arrow labeled '2'). The Inception network extracts features from both the fake and real images.  These features are then processed (arrows labeled '3') to calculate the mean and covariance matrices for both the fake and real image sets.  The fake image features result in 'Fake mean' (a smaller rectangle) and 'Fake covari...' (a larger rectangle), while the real image features result in 'Real mean' and 'Real covari...' (similarly sized rectangles). Finally, these mean and covariance matrices are used to compute the FID score (arrow labeled '4'), a metric that quantifies the similarity between the distributions of real and fake images.  A lower FID score indicates higher image quality." loading="lazy" width="608" height="383" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-18-VOQ2ZS5P.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 18: FID calculation</figcaption></div></figure>
<p><strong>How does the FID measure both diversity and quality?</strong></p>
<ul>
<li><strong>Diversity:</strong> The FID considers the covariance of the features, reflecting the spread and variation in the image features. A diverse set of generated images will have a feature distribution similar to that of real images, showing the model's ability to produce a wide range of different images.</li>
<li><strong>Quality:</strong> FID ensures the generated images are high-quality by comparing their feature distributions to those of real images. If the mean and covariance of the generated images’ features are similar to those of the real images, this indicates that the generated images are likely to be of high quality.</li>
</ul>
<p>FID and Inception score are useful for assessing the quality and diversity of image generation models, but they don't always align with human judgment. This is mainly because these metrics rely on ImageNet classes, which can introduce artifacts. The authors of [30] suggest that using a non-ImageNet-trained model like CLIP could provide a better alignment with human evaluation.</p>
<p>While CLIP-based metrics show promise in improving alignment with human judgment, they still cannot fully replace the insights gained from direct human feedback. Human evaluation still remains the most reliable method for assessing the quality of generated images, as it captures nuances that automated metrics might miss.</p>
<h4 id="human-evaluation">Human evaluation</h4>
<p>Human evaluation is crucial for assessing image generation systems since automated metrics can miss subjective qualities such as aesthetic appeal. There are different protocols to perform human evaluation. One protocol, as outlined in [31], involves presenting users with pairs of images generated by different models. The human evaluators are asked to choose which image looks more photorealistic. This approach lets us compare models based on criteria that align more closely with human judgment.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a user interface element for a comparative image quality assessment.  The main component is a rectangular box displaying the question 'Which image has higher qualit...'  Inside this box are two adjacent, peach-colored square placeholders representing generated images, each outlined in gold. Below each image placeholder is a small, empty square, possibly for user selection or feedback.  A dashed arrow points from the text 'Generated b...' on the left to the leftmost image placeholder, indicating that this image is a result of a generation process. Similarly, a dashed arrow points from the rightmost image placeholder to the text 'Generated b...' on the right, showing the origin of the second image.  The overall structure suggests a user is presented with two generated images and asked to judge which one has superior quality." loading="lazy" width="401" height="136" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-19-SKWUT76M.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 19: Pairwise comparison during human evaluation</figcaption></div></figure>
<h3 id="online-evaluation-metrics">Online evaluation metrics</h3>
<p>Various metrics are typically monitored in practice to ensure that the image generation system performs well and meets user expectations. Two common metrics are:</p>
<ul>
<li><strong>User feedback:</strong> This metric is vital as it directly reflects users' opinions about the generated images. User feedback can be gathered through surveys, ratings, or direct comments.</li>
<li><strong>Latency:</strong> Latency refers to the time it takes from when a request is made until the image is fully generated and delivered to the user. Fast response times are crucial for maintaining a good user experience, especially in interactive applications. Monitoring latency helps identify performance bottlenecks and ensures the system meets user expectations.</li>
</ul>
<h2 id="overall-ml-system-design">Overall ML System Design</h2>
<p>In this section, we explore the holistic design of a realistic face generation system. The key components we'll examine are:</p>
<ul>
<li>Face generator</li>
<li>Training service</li>
<li>Evaluation service</li>
<li>Deployment service</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a system architecture diagram for a face generation application.  A user request ('User requ...') initiates the process, flowing into a 'Face Generator' component (green). This component interacts with a Generative Adversarial Network ('GAN') (grey cloud), which is responsible for generating the face images. The generated face then proceeds to an unspecified component (white box), likely representing an output or display mechanism.  The 'Face Generator' and 'GAN' are enclosed within a dashed box, suggesting a modular inference component. Below this, a vertically stacked series of services manages the system's lifecycle:  'Deployment Ser...' (teal) handles deployment of the model, 'Evaluation Ser...' (rose) evaluates its performance, and 'Training Servi...' (light blue) trains the GAN model using data from 'Training D...' (yellow cylinder, representing a training dataset).  Arrows indicate the flow of data and control between components, showing the training data feeding into the training service, which in turn updates the evaluation service, deployment service, and ultimately the GAN within the Face Generator." loading="lazy" width="343" height="414" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/realistic-face-generation/figure-7-20-4LBPBG7F.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 20: Realistic face generation overall design</figcaption></div></figure>
<h3 id="face-generator">Face generator</h3>
<p>The face generator is the core component responsible for generating realistic faces. It handles user requests and interacts with the trained GAN model to sample high-quality images. Users can optionally specify desired attributes such as age, gender, hairstyle, and expression. The service leverages StyleGAN properties to adjust the noise vector in the latent space based on these attributes.</p>
<p>The architectural details of attribute control and latent manipulation aren’t typically discussed in ML system design interviews. If you are interested in learning more in this space, read [32][33].</p>
<h3 id="training-service">Training service</h3>
<p>The training service continuously improves the GAN model by periodically retraining it with user-approved generated images and new training data.</p>
<h3 id="evaluation-service">Evaluation service</h3>
<p>The evaluation service automatically evaluates newly trained models. It uses predefined metrics to assess their performance. The evaluation results determine whether the new model meets quality standards and should replace the existing one.</p>
<h3 id="deployment-service">Deployment service</h3>
<p>The deployment service deploys improved models to the production environment. It ensures a smooth transition with minimal downtime during updates. The deployment service also monitors the performance of deployed models to ensure they function as expected.</p>
<h2 id="other-talking-points">Other Talking Points</h2>
<p>In case there's extra time after the interview, you might discuss these further topics:</p>
<ul>
<li>Various GAN architectures, such as DCGAN, WGAN, and StyleGAN, and the trade-offs of each architecture [34][35][18].</li>
<li>Techniques for stabilizing GAN training to avoid mode collapse and convergence issues, including the use of Wasserstein loss, gradient penalty, and other robust training methods [36].</li>
<li>Utilize conditional GANs (cGANs) to generate faces based on specific conditions or inputs [37].</li>
<li>Evaluation metrics of condition consistency [38][39].</li>
<li>Style-mixing in face generation [18].</li>
</ul>
<h2 id="summary">Summary</h2>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a mind map summarizing the key aspects of generative AI system design.  The central node is labeled 'Summary,' branching out into five main categories: Clarifying Requirements, Data Preparation, Model Development, Evaluation, and Overall System Components.  'Clarifying Requirements' further branches into 'Framing as ML' (leading to 'ML approach' with sub-branches 'VAE' and 'GAN') and 'Specifying Input and Output.' 'Data Preparation' details steps like removing low-quality images, augmentation, normalization, and diversity enhancement. 'Model Development' breaks down into 'Architecture' (describing Generator components like Transposed Conv, Normalization layers (BN, LN, IN, GN), and non-linear activation functions, and Discriminator components), and 'Training' (including adversarial training, Minimax loss function, and challenges like vanishing gradients, mode collapse, and failure to converge).  'Evaluation' is divided into 'Offline' (Inception score, FID) and 'Online' (Human evaluation, User feedback, Latency) methods. Finally, 'Overall System Components' outlines the Face generator, Training service, Evaluation service, and Deployment service.  Each branch uses color-coding for visual distinction, and the overall structure provides a hierarchical view of the design process, from initial requirements to final deployment." loading="lazy" width="670" height="905" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(670px, 100vw), (max-width: 1200px) min(670px, 80vw), min(670px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Frealistic-face-generation%2Fimage-7-8-TPRG6AXM.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></figure>
<h2 id="reference-material">Reference Material</h2>
<p>[1] StyleGAN2. <a href="https://arxiv.org/abs/1912.04958" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1912.04958</a>.<br>
[2] Auto-Encoding Variational Bayes. <a href="https://arxiv.org/abs/1312.6114" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1312.6114</a>.<br>
[3] Generative Adversarial Networks. <a href="https://arxiv.org/abs/1406.2661" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1406.2661</a>.<br>
[4] Combating Mode Collapse in GAN training: An Empirical Analysis using Hessian Eigenvalues. <a href="https://arxiv.org/abs/2012.09673" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2012.09673</a>.<br>
[5] Google’s GAN course. <a href="https://developers.google.com/machine-learning/gan/training" target="_blank" rel="noopener noreferrer">https://developers.google.com/machine-learning/gan/training</a>.<br>
[6] StackGAN: Text to Photo-realistic Image Synthesis with Stacked Generative Adversarial Networks. <a href="https://arxiv.org/abs/1612.03242" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1612.03242</a>.<br>
[7] Zero-Shot Text-to-Image Generation. <a href="https://arxiv.org/abs/2102.12092" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2102.12092</a>.<br>
[8] Muse: Text-To-Image Generation via Masked Generative Transformers. <a href="https://arxiv.org/abs/2301.00704" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2301.00704</a>.<br>
[9] DALL·E 3. <a href="https://openai.com/index/dall-e-3/" target="_blank" rel="noopener noreferrer">https://openai.com/index/dall-e-3/</a>.<br>
[10] Attribute-specific Control Units in StyleGAN for Fine-grained Image Manipulation. <a href="https://arxiv.org/abs/2111.13010" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2111.13010</a>.<br>
[11] A guide to convolution arithmetic for deep learning. <a href="https://arxiv.org/abs/1603.07285" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1603.07285</a>.<br>
[12] Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift. <a href="https://arxiv.org/abs/1502.03167" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1502.03167</a>.<br>
[13] Layer Normalization. <a href="https://arxiv.org/abs/1607.06450" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1607.06450</a>.<br>
[14] Instance Normalization: The Missing Ingredient for Fast Stylization. <a href="https://arxiv.org/abs/1607.08022" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1607.08022</a>.<br>
[15] Group Normalization. <a href="https://arxiv.org/abs/1803.08494" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1803.08494</a>.<br>
[16] Deep Learning using Rectified Linear Units (ReLU). <a href="https://arxiv.org/abs/1803.08375" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1803.08375</a>.<br>
[17] PyTorch’s Tanh layer. <a href="https://pytorch.org/docs/stable/generated/torch.nn.Tanh.html" target="_blank" rel="noopener noreferrer">https://pytorch.org/docs/stable/generated/torch.nn.Tanh.html</a>.<br>
[18] A Style-Based Generator Architecture for Generative Adversarial Networks. <a href="https://arxiv.org/abs/1812.04948" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1812.04948</a>.<br>
[19] Minimax. <a href="https://en.wikipedia.org/wiki/Minimax" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Minimax</a>.<br>
[20] Loss functions in GANs. <a href="https://developers.google.com/machine-learning/gan/loss" target="_blank" rel="noopener noreferrer">https://developers.google.com/machine-learning/gan/loss</a>.<br>
[21] Towards Principled Methods for Training Generative Adversarial Networks. <a href="https://arxiv.org/abs/1701.04862" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1701.04862</a>.<br>
[22] Unrolled Generative Adversarial Networks. <a href="https://arxiv.org/abs/1611.02163" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1611.02163</a>.<br>
[23] Stabilizing Training of Generative Adversarial Networks through Regularization. <a href="https://arxiv.org/abs/1705.09367" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1705.09367</a>.<br>
[24] Megapixel Size Image Creation using Generative Adversarial Networks. <a href="https://arxiv.org/abs/1706.00082v1" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1706.00082v1</a>.<br>
[25] Inception score. <a href="https://en.wikipedia.org/wiki/Inception_score" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Inception_score</a>.<br>
[26] GANs Trained by a Two Time-Scale Update Rule Converge to a Local Nash Equilibrium. <a href="https://arxiv.org/abs/1706.08500" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1706.08500</a>.<br>
[27] Demystifying MMD GANs. <a href="https://arxiv.org/abs/1801.01401" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1801.01401</a>.<br>
[28] Rethinking the Inception Architecture for Computer Vision. <a href="https://arxiv.org/abs/1512.00567" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1512.00567</a>.<br>
[29] FID calculation. <a href="https://en.wikipedia.org/wiki/Fr%C3%A9chet_inception_distance" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Fr%C3%A9chet_inception_distance</a>.<br>
[30] The Role of ImageNet Classes in Fréchet Inception Distance. <a href="https://arxiv.org/abs/2203.06026" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2203.06026</a>.<br>
[31] Hierarchical Text-Conditional Image Generation with CLIP Latents. <a href="https://arxiv.org/abs/2204.06125" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2204.06125</a>.<br>
[32] Alias-Free Generative Adversarial Networks. <a href="https://arxiv.org/abs/2106.12423" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2106.12423</a>.<br>
[33] StyleGAN3. <a href="https://nvlabs.github.io/stylegan3/" target="_blank" rel="noopener noreferrer">https://nvlabs.github.io/stylegan3/</a>.<br>
[34] Unsupervised Representation Learning with Deep Convolutional Generative Adversarial Networks. <a href="https://arxiv.org/abs/1511.06434" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1511.06434</a>.<br>
[35] Wasserstein GAN. <a href="https://arxiv.org/abs/1701.07875" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1701.07875</a>.<br>
[36] Stabilizing Generative Adversarial Networks: A Survey. <a href="https://arxiv.org/abs/1910.00927" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1910.00927</a>.<br>
[37] Conditional Generative Adversarial Nets. <a href="https://arxiv.org/abs/1411.1784" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1411.1784</a>.<br>
[38] CLIPScore: A Reference-free Evaluation Metric for Image Captioning. <a href="https://arxiv.org/abs/2104.08718" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2104.08718</a>.<br>
[39] DreamBooth: Fine Tuning Text-to-Image Diffusion Models for Subject-Driven Generation. <a href="https://arxiv.org/abs/2208.12242" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2208.12242</a>.</p>
<section data-footnotes="true" class="footnotes"><h2 class="sr-only" id="footnote-label">Footnotes</h2>
<ol>
<li id="user-content-fn-1">
<p>Stride controls how much the filter moves across the input during convolution—larger strides skip more pixels <a data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref" href="/courses/genai-system-design-interview/realistic-face-generation#user-content-fnref-1">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>Padding adds extra borders around the input to control the output size during convolution <a data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref" href="/courses/genai-system-design-interview/realistic-face-generation#user-content-fnref-2">↩</a></p>
</li>
</ol>
</section>
        </article>
    </main>

    <div class="nav">
        <a href="../genai-system-design-interview.html">← Course Contents</a>
        <a href="retrieval-augmented-generation.html">← Previous</a>
        <a href="high-resolution-image-synthesis.html">Next →</a>
    </div>

    <footer class="metadata">
        <p>Scraped on 10/10/2025</p>
    </footer>
</body>
</html>