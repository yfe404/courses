<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Image Generation - Genai System Design Interview</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Open Sans', Arial, sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color: #454545;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

h1 {
    font-size: 2em;
    margin: 1em 0 0.5em 0;
    line-height: 1.2;
}

h2 {
    font-size: 1.5em;
    margin: 1.2em 0 0.6em 0;
    line-height: 1.3;
}

h3 {
    font-size: 1.2em;
    margin: 1em 0 0.5em 0;
    line-height: 1.4;
}

p {
    margin: 0.8em 0;
}

a {
    color: #0077aa;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

ul, ol {
    margin: 0.8em 0;
    padding-left: 2em;
}

li {
    margin: 0.4em 0;
}

code, pre {
    background: #f4f4f4;
    border: 1px solid #ddd;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}

code {
    padding: 2px 5px;
}

pre {
    padding: 10px;
    overflow-x: auto;
    margin: 1em 0;
}

pre code {
    border: none;
    padding: 0;
}

img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 1.5em auto;
}

figure {
    margin: 1.5em 0;
    text-align: center;
}

figcaption {
    font-style: italic;
    font-size: 0.9em;
    color: #666;
    margin-top: 0.5em;
}

.chapter-number {
    font-weight: bold;
    color: #0077aa;
}

.nav {
    margin: 2em 0;
    padding: 1em 0;
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
}

.nav a {
    margin-right: 1em;
}

.toc {
    list-style: none;
    padding: 0;
}

.toc li {
    margin: 0.8em 0;
}

.course-section {
    margin: 2em 0;
}

.course-title {
    font-size: 1.3em;
    font-weight: bold;
    color: #0077aa;
    margin: 1.5em 0 0.8em 0;
}

.metadata {
    font-size: 0.9em;
    color: #888;
    margin: 2em 0 1em 0;
}

.breadcrumb {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 1em;
}

.breadcrumb a {
    color: #0077aa;
}

@media (max-width: 600px) {
    body {
        padding: 10px;
    }

    h1 {
        font-size: 1.5em;
    }

    h2 {
        font-size: 1.3em;
    }
}</style>
</head>
<body>
    <div class="breadcrumb">
        <a href="../../index.html">Home</a> /
        <a href="../genai-system-design-interview.html">Genai System Design Interview</a> /
        Text-to-Image Generation
    </div>

    <div class="nav">
        <a href="../genai-system-design-interview.html">← Course Contents</a>
        <a href="high-resolution-image-synthesis.html">← Previous</a>
        <a href="personalized-headshot-generation.html">Next →</a>
    </div>

    <main>
        <h1>
            <span class="chapter-number">09</span> Text-to-Image Generation
        </h1>

        <div class="metadata">
            <a href="https://bytebytego.com/courses/genai-system-design-interview/text-to-image-generation" target="_blank" rel="noopener">Original source</a>
        </div>

        <article>
            <header><strong class="style_chapter__grtAe">09</strong><h1>Text-to-Image Generation</h1></header><h2 id="introduction">Introduction</h2>
<p>In many cases, instead of allowing the model to generate content from random noise (as discussed in Chapters 7 and 8), we want to control the content of the generated image. Text-to-image generation is a fascinating application of generative AI that allows users to enter a text prompt, which the model transforms into a detailed image. Several text-to-image services are commercially available, such as OpenAI's DALL-E 3 [1], Google's Imagen [2], and Adobe's Firefly [3].</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a humorous illustration depicting a halved avocado sitting on a teal-colored therapist's couch, expressing emotional distress.  The avocado has small arms and legs, a slightly sad facial expression, and a speech bubble emanating from it that reads 'I JUST FEEL SO EMPTY INSIDE.'  Opposite the avocado sits a therapist, represented by a figure with a spoon for a head, wearing a tan suit and holding a clipboard and pen.  A small, potted plant sits on a small wooden side table between the avocado and the therapist. The scene is set on a reddish-orange floor. The overall style is cartoonish and brightly colored, aiming for a comedic effect.  The text 'Prompt: An illustration of an avocado sitting in a therapist's cha...' appears above the image, indicating the prompt that generated the illustration.  At the bottom, the text 'Text is not SVG - cannot display' suggests that some text elements within the image are not properly rendered." loading="lazy" width="446" height="354" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-1-OXG3QF5W.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 1: An example of a prompt and a generated image by OpenAI’s DALL-E 3 [1]</figcaption></div></figure>
<h2 id="clarifying-requirements">Clarifying Requirements</h2>
<p>Here is a typical interaction between a candidate and an interviewer:</p>
<p><strong>Candidate:</strong> What resolution do we target for generated images?<br>
<strong>Interviewer:</strong> We aim for high-resolution images, specifically 1024x1024 pixels.</p>
<p><strong>Candidate:</strong> Should the system support multiple languages for text input or just English?<br>
<strong>Interviewer:</strong> We'll focus on English initially, but the system's architecture should be adaptable for other languages later.</p>
<p><strong>Candidate:</strong> How large is the dataset for training a text-to-image model?<br>
<strong>Interviewer:</strong> We have about 500 million images from user assets, most with captions.</p>
<p><strong>Candidate:</strong> How detailed and complex can the text prompts be? Is there a limit to their complexity or length?<br>
<strong>Interviewer:</strong> The system should handle detailed text prompts, with a maximum length of 128 words.</p>
<p><strong>Candidate:</strong> What speed should the system achieve for image generation?<br>
<strong>Interviewer:</strong> The goal is near–real-time generation. Let’s aim for 10 seconds per image.</p>
<p><strong>Candidate:</strong> What types of images should the system generate? Are we focusing on a specific domain, like landscapes?<br>
<strong>Interviewer:</strong> The system should be capable of generating, based on text prompts, a wide range of images, including realistic landscapes, portraits, and abstract or conceptual art.</p>
<p><strong>Candidate:</strong> It's important to ensure the images aren't biased by age, race, or gender. Can I start by focusing on those three attributes?<br>
<strong>Interviewer:</strong> Great point. It’s crucial to have a fair system. Let's begin by addressing those three attributes.</p>
<p><strong>Candidate:</strong> Ethical considerations are crucial. We need filters and checks to avoid generating offensive, inappropriate, or harmful images. Does that sound correct?<br>
<strong>Interviewer:</strong> Yes, that’s correct.</p>
<h2 id="frame-the-problem-as-an-ml-task">Frame the Problem as an ML Task</h2>
<h3 id="specifying-the-systems-input-and-output">Specifying the system’s input and output</h3>
<p>The input to the system is a text prompt provided by the user that describes the desired image. This prompt usually includes details like scenes, objects, colors, styles, and emotions.</p>
<p>The output is a visually detailed image that adheres to the text prompt. For example, as shown in Figure 2, a prompt like "A boat on an ocean" produces an image depicting this scene.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simplified data flow diagram illustrating a text-to-image generation process.  On the left, 'Text prompt:...' indicates a text input, representing the user's textual description for the desired image. A black arrow points right, signifying the flow of this text input into a centrally located, light-orange, rounded-rectangle box labeled 'Text-to-Image...'. This box represents the core text-to-image model or system.  Another black arrow extends right from the 'Text-to-Image...' box, indicating the output.  On the far right, a photograph of a sailboat on a calm sea is displayed, representing the generated image output from the 'Text-to-Image...' process. The overall diagram visually depicts the transformation of a textual prompt into a corresponding image through an unspecified text-to-image generation system." loading="lazy" width="580" height="207" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-2-S5FPVU2H.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 2: Input and output of a text-to-image system. Image credit: [4]</figcaption></div></figure>
<h3 id="choosing-a-suitable-ml-approach">Choosing a suitable ML approach</h3>
<p>Text-to-image generation is a multimodal task that involves understanding text and generating a corresponding image. There are two primary approaches for building text-to-image systems:</p>
<ul>
<li>Autoregressive models</li>
<li>Diffusion models</li>
</ul>
<p>Let’s briefly review each and choose the one that best suits our needs.</p>
<h4 id="autoregressive-models">Autoregressive models</h4>
<p>These models treat text-to-image generation as a sequence generation task. A decoder-only Transformer takes a sequence of text tokens as input and outputs a sequence of visual tokens representing an image. An image tokenizer then decodes these visual tokens into the actual image.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simplified diagram of a decoder-only transformer model generating an image from a text prompt.  At the bottom, a text prompt 'A boat on an ocean' is input.  This prompt is then tokenized into several units represented by empty squares labeled 'Text tokens'. These tokens are fed as input into a decoder-only transformer, depicted as a peach-colored rectangle with the label 'Decoder-only Transformer'.  The transformer also receives input from above, consisting of image tokens (also represented by empty squares labeled 'Image tokens'), which are likely embeddings representing an image.  The output of the transformer flows upwards, ultimately generating an image of a sailboat on the ocean, shown at the top of the diagram.  The arrows indicate the direction of information flow, showing how the text prompt and potentially existing image tokens are processed by the transformer to produce the final generated image." loading="lazy" width="332" height="360" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-3-EVPPXBGI.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 3: Autoregressive text-to-image generation</figcaption></div></figure>
<p>Several text-to-image models have been developed using this approach, such as OpenAI’s DALL-E [5] and Google’s Muse [6].</p>
<h4 id="diffusion-models">Diffusion models</h4>
<p>First introduced in 2019 [7], diffusion models gained mainstream attention about three years later. They use a different approach for text-to-image generation by starting with random noise and gradually transforming it into a clear image based on the text prompt. This process typically involves a text encoder, such as OpenAI’s CLIP [8] or Google’s T5 [9], which converts the text prompt into an embedding. This embedding captures the meaning of the prompt and guides the diffusion model to generate images that match it.<sup><a id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fn-1">1</a></sup></p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating a diffusion model for image generation.  The process begins with an 'Initial...' state, depicted as a square filled with random noise. This noise is fed into the first of a series of 'Diffusion Mod...' blocks, represented as light orange rectangles. Each 'Diffusion Mod...' block receives input from the previous block and a 'Text Enc...' block (light purple rectangle). The 'Text Enc...' blocks process text prompts, in this case, 'A boat on...', and their output is used to guide the diffusion process within the corresponding 'Diffusion Mod...' block.  The 'Diffusion Mod...' blocks iteratively refine the image, starting from the initial noise.  Intermediate results are shown as progressively clearer images of a sailboat on water.  The final 'Diffusion Mod...' block outputs a high-quality image of a sailboat, significantly improved from the initial noise.  Arrows indicate the flow of information between the blocks, showing how the text prompts and the intermediate image representations are used to generate the final image." loading="lazy" width="628" height="243" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-4-CZWRHW7T.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 4: Diffusion-based text-to-image generation</figcaption></div></figure>
<p>Examples of diffusion-based text-to-image models include Google’s Imagen 3 [2], OpenAI’s DALL-E 2 [10], and Stability AI’s Stable Diffusion [11].</p>
<h4 id="diffusion-versus-autoregressive-models">Diffusion versus autoregressive models</h4>
<p>Autoregressive models frame text-to-image generation as a sequence generation task, while diffusion models approach it as an iterative refinement process. This key difference in modeling impacts their capabilities.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a Venn diagram comparing and contrasting diffusion and autoregressive generative models.  Two overlapping circles are presented. The left, peach-colored circle, is labeled 'Diffusion...' at the top and contains the text 'Exceptional...' and 'Expensive...' within it. The right, lavender-colored circle, is labeled 'Autoregressive...' at the top and contains 'Uniform architectu...' and 'Simple to imple...' within it. The overlapping section of the circles contains the text 'Slow gene...' and 'Billions...'.  The diagram visually illustrates the shared characteristics ('Slow gene...', 'Billions...') and distinct characteristics of each generative model type, highlighting that diffusion models are characterized as exceptional and expensive, while autoregressive models are described as having a uniform architecture and being simple to implement." loading="lazy" width="344" height="248" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-5-2SDEBR35.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5: Diffusion vs. autoregressive model characteristics</figcaption></div></figure>
<p>Both diffusion and autoregressive models can produce realistic images, are slow in generation, typically have billions of parameters, and require substantial computational resources for training. Despite these similarities, they differ in three key aspects:</p>
<ol>
<li><strong>Implementation complexity</strong>: Autoregressive models are simpler to implement during both training and inference. During training, they are more statistically efficient because they can obtain useful gradient signals from all steps in a single forward-backward pass. In contrast, diffusion models are less statistically efficient, requiring sampling of different noise levels for each training example. At inference time, once the Transformer in an autoregressive model generates the sequence of visual tokens, these tokens form the final image. Diffusion models, however, refine the image over many steps, adding complexity to the implementation.</li>
<li><strong>Image quality</strong>: Diffusion models have shown better performance in generating highly detailed and realistic images. Their iterative process allows the model to continuously refine and enhance fine details, leading to superior overall realism in the generated images.</li>
<li><strong>Flexibility in sampling</strong>: Diffusion models are more flexible in trading off sampling speed and image quality. They can easily adjust the number of sampling steps—more steps usually lead to higher-quality images but take more time. Once trained, an autoregressive model cannot easily make such adjustments.</li>
</ol>
<p>In this chapter, we choose diffusion models to prioritize exceptional image quality. In the model development section, we explore the architecture, training methods, and sampling techniques of diffusion models.</p>
<h2 id="data-preparation">Data Preparation</h2>
<p>Our dataset consists of approximately 500 million image–caption pairs. However, large-scale datasets often require substantial preprocessing before they can be used for model training. In this section, we explore common techniques to prepare images and captions for diffusion training.</p>
<h3 id="image-preparation">Image preparation</h3>
<p>We focus on two main steps to prepare the images: filtering inappropriate images and standardizing the remaining ones. Let's delve into each step in more detail.</p>
<h4 id="filtering-inappropriate-images">Filtering inappropriate images</h4>
<p>In large-scale datasets, many images may not be useful for training. It's crucial to remove these to ensure the model learns only from high-quality and safe data. To achieve this, we perform the following steps:</p>
<ul>
<li><strong>Remove small images:</strong> We discard image–caption pairs where the image size is smaller than a certain threshold, for example, 64×64 pixels. Small images are often of poor quality and may not provide valuable information for training.</li>
<li><strong>Deduplicate images:</strong> We use deduplication methods, such as [12], to remove identical or perceptually similar images. This prevents the model from being biased toward certain images that appear more frequently.</li>
<li><strong>Remove inappropriate images:</strong> We employ harm detection and NSFW (Not Safe For Work) detection models to filter out harmful content such as violence or nudity. This ensures the model doesn't learn to generate inappropriate images.</li>
<li><strong>Remove low-aesthetic images:</strong> We use specialized ML models to eliminate images that aren't aesthetically pleasing. This helps the model focus on high-quality images during training.</li>
</ul>
<h4 id="standardizing-images">Standardizing images</h4>
<ul>
<li><strong>Adjust image dimensions:</strong> The diffusion model requires inputs of specific dimensions. Therefore, it's crucial to have training data of similar sizes. For example, if the expected model input is 128x128, we first resize the images so that the smaller dimension is 128, preserving the aspect ratio. Then, we center-crop them to achieve the final size of 128x128.</li>
<li><strong>Normalize images:</strong> We normalize pixel values to a standard range such as [0, 1] or [-1, 1] for more stable training.</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a data processing pipeline for image preparation.  It begins with a rectangular box labeled 'Original ima...' representing the input image.  This image flows rightward through a series of processing steps depicted as rounded rectangles. The first step, 'Resize,' changes the image dimensions.  Next, 'Center Crop' extracts a central portion of the resized image, indicated by a smaller square box above it with a visual representation of cropping using L-shaped lines.  A curved arrow connects this cropping visual to the square representing the cropped image. The image then proceeds to 'Normalize...', which likely adjusts pixel values. Finally, the processed image is outputted into a rectangular box labeled 'Prepared...'.  Arrows between each stage indicate the flow of the image data through the pipeline." loading="lazy" width="604" height="183" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-6-ZMT5EU2U.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 6: Image preparation steps</figcaption></div></figure>
<h3 id="caption-preparation">Caption preparation</h3>
<p>In addition to images, captions are often irrelevant or missing. Here are common steps to ensure captions are consistent and of high quality:</p>
<ul>
<li><strong>Handle missing or non-English captions:</strong> For images without captions or with captions in another language, we use an image captioning model such as BLIP-3 [13] to automatically generate descriptive captions. If you would like to build an image captioning system from scratch, refer to Chapter 5.</li>
<li><strong>Enhance captions:</strong> We use a pretrained model such as CLIP [8] to score the relevance of each image–caption pair. For pairs scoring below a threshold, we replace the original caption with an auto-generated one using the BLIP-3 model.</li>
<li><strong>Remove poorly matched pairs:</strong> After enhancing captions, we remove image–caption pairs with CLIP similarity scores below a threshold. This step ensures that the model is exposed only to pairs whose captions accurately describe the images.</li>
</ul>
<h2 id="model-development">Model Development</h2>
<h3 id="architecture">Architecture</h3>
<p>A diffusion model, as previously explained, progressively denoises a noisy image through multiple steps until it becomes clear. In each step, as illustrated in Figure 7, the model takes a noisy image as input and predicts the noise to be removed.<sup><a id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fn-2">2</a></sup> Two common architectures are typically used for this purpose:</p>
<ul>
<li>U-Net</li>
<li>Diffusion Transformer (DiT)</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simplified diagram of a denoising process within a generative model, likely for image generation.  The process begins with a 'Noisy image...' depicting a sailboat on water with added noise. This noisy image is fed into a 'Diffusion Mod...' (Diffusion Model) block, a key component of diffusion models.  The Diffusion Model also receives input from a 'Text Encoder' block, which processes the text prompt 'A boat on...' to provide contextual information. The Diffusion Model outputs a 'Predicted...' image, which is primarily noise but contains latent information about the sailboat. This noisy prediction then undergoes 'Noise removal,' a process that refines the image, resulting in a 'Refined...' image, a clearer depiction of the sailboat.  Above the main process flow, a smaller box visually demonstrates the noise removal step: an original image of a sailboat is shown, followed by a noisy version, and then an equals sign (=) leading to the same sailboat image but with reduced noise, mirroring the effect of the main process.  Arrows indicate the flow of data between the components." loading="lazy" width="559" height="327" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-7-M7MESQJ3.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 7: Input and output of the diffusion model in a single step</figcaption></div></figure>
<h4 id="u-net">U-Net</h4>
<p>U-Net [14] is a convolutional neural network (CNN) architecture originally developed for biomedical image segmentation. It consists of a series of downsampling blocks followed by upsampling blocks, as shown in Figure 8.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating a U-Net architecture for image processing.  The top section shows a series of six 3D rectangular blocks representing feature maps at different stages of processing, with dimensions labeled (e.g., 128x32x32, 256x16x16, etc.), decreasing in height and width and increasing in depth as they progress towards the center.  These blocks are connected by a curved arrow pointing to the 'Intermediate...' label, indicating a transition to the next stage. The bottom section depicts the U-Net itself.  A 3x64x64 input 'Image' block feeds into a sequence of processing blocks within the U-Net.  The initial blocks, labeled 'D' and colored light red, represent downsampling operations.  These are followed by a series of blocks labeled 'U' and colored light green, representing upsampling operations.  The 'D' blocks are grouped under 'Downsampling bl...' and the 'U' blocks under 'Upsampling bloc...', indicating the two main phases of the network.  Ellipses (...) indicate that multiple 'D' and 'U' blocks are present but not explicitly shown. Finally, the processed data exits the U-Net into a 3x64x64 output 'Predicted...' block.  The overall flow is from left to right, with the downsampling phase reducing spatial dimensions and the upsampling phase reconstructing them, ultimately producing a predicted image." loading="lazy" width="620" height="303" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-8-3DCGJCBD.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 8: U-Net downsampling and upsampling blocks</figcaption></div></figure>
<h5 id="downsampling-blocks">Downsampling blocks</h5>
<p>The downsampling blocks progressively reduce spatial dimensions (height and width) while increasing depth (number of channels), leading to a compressed representation of the input. Each downsampling block typically consists of the following:</p>
<ul>
<li><strong>Convolution operation</strong>: Extracts visual features from the input.</li>
<li><strong>Batch normalization</strong>: Normalizes feature maps to stabilize training.</li>
<li><strong>Non-linear activation</strong>: Introduces non-linearity to learn complex patterns.</li>
<li><strong>Max-pooling</strong>: Reduces the feature map dimensions.</li>
<li><strong>Cross-attention</strong>: Cross-attends to additional conditions, such as text prompt tokens. This is necessary to ensure the text prompt influences the predicted noise.</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the architecture of a U-Net.  The top section shows a single block containing four processing layers arranged horizontally:  `Conv2D`, `BatchNorm...`, `ReLU`, and `MaxPool...`, followed by a `Cross-Atte...` layer.  These layers are depicted as individual boxes within a dashed-line rectangle, suggesting a repeated module.  Below this, the main U-Net architecture is shown.  It consists of a series of light-pink boxes labeled 'D' representing downsampling blocks, connected sequentially with arrows indicating data flow.  An ellipsis (...) indicates repetition of the 'D' blocks.  These downsampling blocks are grouped together and labeled 'Downsampling bl...'.  Following the downsampling blocks, a series of light-green boxes labeled 'U' represent upsampling blocks, also connected sequentially with arrows.  An ellipsis (...) again indicates repetition of the 'U' blocks.  These upsampling blocks are grouped and labeled 'Upsampling bloc...'.  A dashed line connects the top block to the downsampling section, implying that the top block represents the processing within each 'D' block.  The overall structure resembles the letter 'U', hence the name U-Net." loading="lazy" width="544" height="231" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-9-UG7YRW2U.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 9: Typical layers in a downsampling block</figcaption></div></figure>
<p>Let's explore the cross-attention layer in more detail, as this is the first instance where we're applying cross-attention between different modalities—image and text inputs. The text prompt is processed by a text encoder, such as a Transformer-based model, which converts words or tokens into a sequence of continuous embeddings. These embeddings capture the semantic meaning of the text. During each denoising step of the diffusion process, the model receives a noisy image as input and processes it through layers like <em>Conv2D</em> and <em>BatchNorm2D</em> to extract visual features. In the cross-attention layer, the queries are derived from the image features, while the keys and values come from the text embeddings. This enables the model to align and integrate information effectively from the text into the image features.</p>
<h5 id="upsampling-blocks">Upsampling blocks</h5>
<p>The upsampling blocks symmetrically increase spatial dimensions and decrease feature map depth. The final output matches the original input size, which, in this case, is the predicted noise. Each upsampling block consists of the following:</p>
<ul>
<li><strong>Transposed convolution:</strong> Uses operations like PyTorch’s <em>ConvTranspose2D</em> to process and increase the feature map’s dimensions.</li>
<li><strong>Batch normalization</strong>: Normalizes feature maps to stabilize training.</li>
<li><strong>Non-linear activation</strong>: Introduces non-linearity to learn complex patterns.</li>
<li><strong>Cross-attention:</strong> Maintains the influence of additional conditions during upsampling.</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a U-Net architecture diagram.  The main body shows a sequence of processing blocks.  On the left, several light-red blocks labeled 'D' represent downsampling blocks, arranged sequentially with arrows indicating data flow from left to right.  Ellipses (...) indicate the repetition of this pattern.  On the right, several light-green blocks labeled 'U' represent upsampling blocks, also arranged sequentially with data flowing from left to right, again with ellipses (...) showing repetition.  A gray brace underneath the 'D' blocks is labeled 'Downsampling bl...', and a similar brace under the 'U' blocks is labeled 'Upsampling bloc...'.  Above the upsampling blocks, a dashed box outlines a detailed view of a single upsampling block, showing four sub-blocks arranged horizontally: 'Transposed...', 'BatchNorm...', 'ReLU', and 'Cross-Atte...', indicating the constituent operations within each upsampling block.  The dashed lines connect this detailed view to the general upsampling block representation in the main U-Net diagram, illustrating the internal structure of the 'U' blocks.  The entire main body is labeled 'U-Net' at the top left, indicating the overall architecture." loading="lazy" width="480" height="208" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-10-5P7MJQ2J.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 10: Typical layers in an upsampling block</figcaption></div></figure>
<p>The U-Net architecture has various details and variations. Different implementations may use different layers and configurations. However, understanding the key components and structure is generally sufficient for most ML system design interviews. For more in-depth information, refer to [14].</p>
<h4 id="dit">DiT</h4>
<p>DiT [15] is another popular architecture in diffusion models. Unlike U-Net, which uses a series of downsampling and upsampling layers, DiT primarily relies on a Transformer architecture to process the noisy input image and predict the noise.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a denoising model architecture.  At the bottom, a 'Noisy image' box feeds into a larger rectangular block representing the core model. Inside this block, from bottom to top, are: 'Patchify' (a layer that divides the image into patches), 'Positional Encoding' (adding positional information to the patches), a 'Transformer' (the main processing unit), and 'Unpatchify' (recombining the processed patches).  The output of the 'Unpatchify' layer is a 'Predicted noise' box, which represents the model's estimate of the noise in the input image.  A separate box labeled 'Conditions...' is connected to the input of the Transformer, suggesting that the model can incorporate additional contextual information.  The entire process aims to subtract the 'Predicted noise' from the 'Noisy image' to obtain a cleaner image (not explicitly shown)." loading="lazy" width="288" height="440" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-11-T77AHJII.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 11: DiT components</figcaption></div></figure>
<p>DiT is primarily inspired by the Vision Transformer (ViT) [16] architecture discussed in Chapter 5. DiT components are:</p>
<ul>
<li><strong>Patchify:</strong> Converts the input image into a sequence of patch embeddings.</li>
<li><strong>Positional encoding:</strong> Attaches position information to each patch embedding to indicate its location in the original image.</li>
<li><strong>Transformer:</strong> Processes the sequence of embeddings and other conditioning signals, such as the text prompt, to predict the noise for each patch.</li>
<li><strong>Unpatchify:</strong> Converts the sequence of predicted noise vectors into an image with the same dimension as the original input image.</li>
</ul>
<p>In summary, both U-Net and DiT architectures perform well in practice. U-Net was originally used in several text-to-image models such as Google’s Imagen [17] and Stability AI’s Stable Diffusion [11]. Recently, the DiT architecture has shown great promise for text-to-image generation. For educational purposes, we use the U-Net architecture in this chapter. Chapter 11 explores the DiT architecture in more detail.</p>
<h3 id="training">Training</h3>
<p>A diffusion model is trained by employing the diffusion process. The diffusion process has two phases:</p>
<ul>
<li>Forward process</li>
<li>Backward process</li>
</ul>
<h4 id="forward-process">Forward process</h4>
<p>In the forward process, also known as the <strong>noising process</strong>, noise is gradually added to an image over multiple steps (denoted as <em>t</em> or timesteps) until the image becomes completely noisy. The value of <em>t</em>, representing the number of steps, is typically chosen randomly from a range, usually between 1 and 1,000. The forward process does not involve any ML models or parameter updates.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a sequence of image transformations.  It begins with a clear image of a sailboat on the water labeled '$x_0...' This image is then progressively altered. A rightward arrow indicates a transformation to a slightly noisier version of the same image, labeled '$x_1...'.  This process continues with the addition of more noise, represented by the text 'Noise...', and three dots indicating a series of intermediate steps. The next visible image, labeled '$x_{...}', shows a significantly noisier version of the original, where details are becoming obscured. Finally, a further transformation, indicated by another rightward arrow, results in a heavily degraded image labeled '$x_{...}', where the sailboat is barely discernible amidst the noise.  The labels suggest a sequence of images ($x_i$) where the subscript *i* represents the increasing level of noise added to the original image." loading="lazy" width="576" height="143" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-12-I7PC7S65.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 12: Forward diffusion process</figcaption></div></figure>
<h4 id="backward-process">Backward process</h4>
<p>In the backward process, also known as the <strong>denoising process</strong>, an ML model learns to reverse the forward process. At each step, the model predicts the noise in the noisy image. This predicted noise is then used to reduce the noise in the input image. As shown in Figure 13, this process is repeated until the image becomes clear.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a denoising process using a diffusion model.  The diagram shows a sequence of four image representations, labeled  `$x_0...`, `$x_1...`, `$x_{...}...`, and `$x_t...`, progressing from a clear image of a sailboat at sea (`$x_0...`) to increasingly noisy versions (`$x_1...`, `$x_{...}...`, `$x_t...`).  Arrows indicate the flow of information:  `$x_0...` is fed into a 'Diffusion...' process (represented by a peach-colored box), which then outputs `$x_1...`.  This process is repeated, with each subsequent image becoming noisier due to added 'Noise...'.  The noisy image `$x_t...` is then fed into a second 'Diffusion...' process, suggesting a reverse diffusion process to reconstruct the original image from the noisy input.  The ellipses (...) in the labels suggest that the images represent a sequence of many steps, not just the four shown." loading="lazy" width="564" height="215" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-13-ZFWFVMDK.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 13: Backward diffusion process</figcaption></div></figure>
<p>With an understanding of both the forward and backward processes, we can now explore how they are applied during the diffusion training process.</p>
<h4 id="diffusion-training-process">Diffusion training process</h4>
<p>During training, we introduce noise to the original image by simulating the forward process, then ask the model to predict this noise. This process involves four key steps:</p>
<ol>
<li>Noise addition</li>
<li>Preparation of conditioning signals</li>
<li>Noise prediction</li>
<li>ML objective and loss calculation</li>
</ol>
<p>This section includes some math for those who are interested, but the details do not affect the design of the ML system.</p>
<h5 id="1-noise-addition">1. Noise addition</h5>
<p>The first step is to simulate the forward diffusion process by adding noise to the original image over multiple timesteps. At each timestep, we corrupt the image slightly by adding Gaussian noise. This gradual addition of noise transforms the image into pure noise over time.</p>
<p>The amount of noise added at each timestep is controlled by a <strong>noise schedule</strong>. The noise schedule is defined by a set of variance parameters, 1, 2, ...,T​, where T is the total number of timesteps. Each t(0,1) controls the amount of noise added at timestep t.</p>
<p>The noise schedule typically increases the values of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span></span></span></span> incrementally:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>β</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>β</mi><mn>2</mn></msub><mo>&lt;</mo><mo>…</mo><mo>&lt;</mo><msub><mi>β</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">\beta_1&lt;\beta_2&lt;\ldots&lt;\beta_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="minner">…</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
<p>Thus, smaller amounts of noise are added in the early steps, preserving more of the original image, and larger amounts of noise are added in the later steps, accelerating the diffusion process.</p>
<p>With the noise schedule defined, we can express the noisy data at timestep <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> using the noise addition formula:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msqrt><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>β</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></msqrt><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msqrt><msub><mi>β</mi><mi>t</mi></msub></msqrt><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">x_t = \sqrt{(1-\beta_t)}x_{t-1} + \sqrt{\beta_t}\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.24em; vertical-align: -0.2561em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9839em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top: -2.9439em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2561em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.24em; vertical-align: -0.2561em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9839em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9439em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2561em;"><span></span></span></span></span></span><span class="mord mathnormal">ϵ</span></span></span></span></span>
<p>where:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> is the noisy image at timestep <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">x_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6389em; vertical-align: -0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span></span> is the noisy image at timestep <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6984em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span>,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> is the Gaussian noise sampled from the standard normal distribution <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(0, I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mclose">)</span></span></span></span>,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> is the variance schedule parameter at timestep t, controlling the amount of noise added.</li>
</ul>
<p>Iteratively adding noise over many steps can be time-consuming. Instead, it can be shown that the noisy data at timestep <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> can be directly derived from the original data, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span>:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msqrt><msub><mi>α</mi><mi>t</mi></msub></msqrt><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi>α</mi><mi>t</mi></msub></mrow></msqrt><msub><mi>ϵ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><msub><mi>α</mi><mi>t</mi></msub></msqrt><mrow><mo fence="true">(</mo><msqrt><msub><mi>α</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></msqrt><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi>α</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt><msub><mi>ϵ</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi>α</mi><mi>t</mi></msub></mrow></msqrt><msub><mi>ϵ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><mrow><msub><mi>α</mi><mi>t</mi></msub><msub><mi>α</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi>α</mi><mi>t</mi></msub><msub><mi>α</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></msqrt><msubsup><mi>ϵ</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>…</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><msubsup><mi>α</mi><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></msqrt><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msubsup><mi>α</mi><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></msqrt><mi>ϵ</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
	&amp; x_t=\sqrt{\alpha_t} x_{t-1}+\sqrt{1-\alpha_t} \epsilon_{t-1} \\
	&amp; =\sqrt{\alpha_t}\left(\sqrt{\alpha_{t-1}} x_{t-2}+\sqrt{1-\alpha_{t-1}} \epsilon_{t-2}\right)+\sqrt{1-\alpha_t} \epsilon_{t-1} \\
	&amp; =\sqrt{\alpha_t \alpha_{t-1}} x_{t-2}+\sqrt{1-\alpha_t \alpha_{t-1}} \epsilon_{t-2}^{\prime} \\
	&amp; =\ldots \\
	&amp; =\sqrt{\alpha_t^{\prime}} x_0+\sqrt{1-\alpha_t^{\prime}} \epsilon
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 8.3909em; vertical-align: -3.9454em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 4.4454em;"><span style="top: -6.7143em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"></span></span><span style="top: -4.9043em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"></span></span><span style="top: -3.0024em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"></span></span><span style="top: -1.5024em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"></span></span><span style="top: 0.1354em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.9454em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 4.4454em;"><span style="top: -6.7143em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7742em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.7342em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2658em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8811em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.8411em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1589em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top: -4.9043em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7742em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.7342em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2658em;"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.745em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.705em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.295em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9519em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9119em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2881em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8811em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.8411em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1589em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top: -3.0024em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.745em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.705em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.295em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9519em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9119em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2881em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8019em;"><span style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3053em;"><span></span></span></span></span></span></span></span></span><span style="top: -1.5024em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="minner">…</span></span></span><span style="top: 0.1354em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9778em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7337em;"><span style="top: -2.4542em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2458em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9378em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2622em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9778em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7337em;"><span style="top: -2.4542em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2458em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9378em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2622em;"><span></span></span></span></span></span><span class="mord mathnormal">ϵ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.9454em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<p>where:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> is the noisy image at timestep <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>β</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_t=1-\beta_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>α</mi><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></msubsup><msub><mi>α</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_t^{\prime}=\prod_{i=1}^t \alpha_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.9989em; vertical-align: -0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span style="top: -2.453em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2332em; vertical-align: -0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: 0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9335em;"><span style="top: -2.4003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> are reparameterizations of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span>,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> is the Gaussian noise sampled from the standard normal distribution <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(0, I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mclose">)</span></span></span></span>.</li>
</ul>
<p>In summary, during noise addition, we randomly sample <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> and compute <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> directly from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span>, without the need to iteratively add noise at each timestep, using the following formula:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msqrt><msubsup><mi>α</mi><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></msqrt><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msubsup><mi>α</mi><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></msqrt><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">x_t=\sqrt{\alpha_t^{\prime}} x_0+\sqrt{1-\alpha_t^{\prime}} \epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.24em; vertical-align: -0.2622em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9778em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7337em;"><span style="top: -2.4542em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2458em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9378em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2622em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.24em; vertical-align: -0.2622em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9778em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7337em;"><span style="top: -2.4542em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2458em;"><span></span></span></span></span></span></span></span></span><span style="top: -2.9378em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2622em;"><span></span></span></span></span></span><span class="mord mathnormal">ϵ</span></span></span></span></span>
<h5 id="2-preparation-of-conditioning-signals">2. Preparation of conditioning signals</h5>
<p>To predict the added noise, the model typically expects two additional pieces of information: the image caption and the sampled timestep, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, which indicates the noise level. We use separate encoders (see Figure 14) to prepare each of these conditioning signals to be processed by the model.</p>
<h5 id="3-noise-prediction">3. Noise prediction</h5>
<p>The primary goal of training a diffusion model is to learn how to reverse the forward diffusion process-that is, to reconstruct the original data, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span>, from its noisy version, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span>. It has been shown that directly predicting <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> is not as effective. Instead, training the model to predict the noise, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>, added during the forward process simplifies the task and improves performance. Therefore, in this step, the model predicts the noise, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>, given the noisy input, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span>, and the timestep, t.<sup><a id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fn-3">3</a></sup></p>
<h5 id="4-ml-objective-and-loss-calculation">4. ML objective and loss calculation</h5>
<p>The ML objective is to minimize the difference between the true noise, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>, and the model's prediction. The loss function used is the mean squared error (MSE) between the true noise and the predicted noise:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><mi>ϵ</mi></mrow></msub><mrow><mo fence="true">(</mo><msup><mrow><mo fence="true">∥</mo><mi>ϵ</mi><mo>−</mo><msub><mi>ϵ</mi><mi>θ</mi></msub><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow><mo fence="true">∥</mo></mrow><mn>2</mn></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">L=E_{t, x_0, \epsilon}\left(\left\|\epsilon-\epsilon_\theta\left(x_t, t\right)\right\|^2\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: -0.0576em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">ϵ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∥</span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mclose delimcenter" style="top: 0em;">∥</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.954em;"><span style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>
<p>where:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> is a timestep sampled uniformly from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{1,2, \ldots, T\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">T</span><span class="mclose">}</span></span></span></span>,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\epsilon \sim N(0, I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.07847em;">I</span><span class="mclose">)</span></span></span></span> is the Gaussian noise used in the forward process,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span> is the noisy data at timestep <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, computed using the noise addition formula,</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>θ</mi></msub><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_\theta\left(x_t, t\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose delimcenter" style="top: 0em;">)</span></span></span></span></span> is the prediction of the neural network model (U-Net or DiT).</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the training process of a text-to-image diffusion model.  The process begins with a training dataset (a table with 'ID', 'Image', and 'Caption' columns, showing example image-caption pairs).  This dataset feeds into a 'Noise addition' stage (1), where random noise is added to an image from the dataset using a 'Forward...' process and a specified 'Timestep...' (t=800). The resulting 'Noised image a...' is then input into a 'Noise prediction' stage (3), which uses a 'Diffusion...' model. This model receives input from a 'Preparation of...' stage (2), which takes the caption from the training dataset and a 'Timestep...' (t=800) to generate embeddings. The 'Diffusion...' model outputs a predicted noise image. Finally, a 'Loss calculation' stage (4) compares the predicted noise with the actual noise added in stage 1, calculating the loss to update the model's parameters.  The entire cycle, from noise addition to loss calculation, iteratively refines the model's ability to generate images from text captions." loading="lazy" width="644" height="383" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-14-RGHHCRW3.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 14: A single iteration in diffusion training</figcaption></div></figure>
<p>To enhance the reading experience, we have omitted the mathematical details, such as the derivation of the tractable mean and the loss simplification. For more information on diffusion training, refer to [18].</p>
<h3 id="sampling">Sampling</h3>
<p>Sampling refers to generating a new image from a trained diffusion model. In this section, we’ll explore how sampling works in diffusion models and how noises are transformed into coherent images guided by the text prompt.</p>
<p>The sampling process starts with an image of random pixels, typically drawn from a Gaussian distribution. The model then gradually refines this image step by step. At each step, the diffusion model predicts the noise present in the current image and uses this prediction to adjust the image slightly in the right direction. This gradual refinement continues, each step producing a clearer image until a clear and detailed image is achieved.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a denoising diffusion process for image generation.  It begins with a rectangular box labeled 'Random Noise...', representing an initial input of random noise data.  An arrow points from this box to a noisy image labeled '$x_{99}...', indicating the initial state of the image. This noisy image is then fed into a rectangular box labeled 'Diffusion...', representing a diffusion model that processes the image.  The output of this first diffusion step is a less noisy image, also labeled '$x_{99}...', showing a slightly clearer image (in this case, a sailboat).  This process is repeated, indicated by an ellipsis ('...') connecting the output of the first diffusion step to the input of a second 'Diffusion...' box.  The second diffusion step further refines the image, resulting in a clearer image of the sailboat labeled '$x_{0}...'.  Crucially, both 'Diffusion...' boxes receive an additional input labeled 'Input tex...', suggesting textual prompts guide the denoising process towards a specific image.  The arrows illustrate the unidirectional flow of data through the system, transforming random noise into a coherent image based on the provided text prompt." loading="lazy" width="620" height="144" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-15-2AGKPRGO.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 15: Sampling process</figcaption></div></figure>
<p>The basic sampling process described above has two drawbacks. First, it often fails to generate images that accurately match the text prompt. Second, it is slow, because generating each sample requires many iterative steps. The following two techniques are commonly employed in practice to mitigate the issues described above:</p>
<ul>
<li><strong>Classifier-free guidance (CFG)</strong>: CFG [19] improves the alignment between images and text prompts in diffusion models. During training, the model learns to generate images with and without the text prompt. During sampling, CFG adjusts the balance between these two modes. CFG ensures the generated images closely match the text prompts by increasing the influence of the conditioned (text prompt) mode and reducing the unconditioned (no text prompt) mode. This adjustment guides the diffusion process to produce more accurate results. To learn more about CFG, refer to [19].</li>
<li><strong>Reduction of diffusion steps:</strong> Sampling algorithms such as DDIM [20] reduce the number of diffusion steps from the standard 1,000 to as few as 20. This significantly speeds up the generation process while maintaining image quality. To learn more about DDIM, refer to [20].</li>
</ul>
<p>In most ML system design interviews, the focus is on high-level concepts and how components work together, not on the intricate details. If you are interested in exploring diffusion models in more depth, refer to [21][19][20].</p>
<h3 id="challenges-in-text-to-image-diffusion-models">Challenges in text-to-image diffusion models</h3>
<p>Diffusion models are typically very large. For example, DALLE-2 has 3.5 billion parameters [10]. This capacity is necessary since these models have to learn diverse concepts, shapes, and styles.</p>
<p>Training such large models poses several challenges during both training and sampling. The most common ones include:</p>
<ul>
<li>Resource-intensive model training</li>
<li>Slow image generation</li>
</ul>
<h4 id="resource-intensive-model-training">Resource-intensive model training</h4>
<p>Training diffusion models is computationally intensive, requiring significant processing power. It also requires substantial GPU memory due to the size of the model and the high-dimensional nature of the generated images. Most modern GPUs may not have sufficient memory to fit model parameters, activations, and gradients during training. The following strategies are commonly employed to overcome these challenges:</p>
<ul>
<li><strong>Mixed precision training:</strong> This technique uses both 16-bit and 32-bit floating-point types to reduce memory usage and increase computational efficiency. To learn more, refer to [22].</li>
<li><strong>Model and data parallelism:</strong> These methods distribute training across multiple devices. Most distributed training frameworks, such as FSDP [23] and Deepspeed [24], support various parallelism techniques.</li>
<li><strong>Latent diffusion models:</strong> These models operate in a lower-dimensional space instead of pixel space, significantly speeding up training and inference. Chapter 11 examines this approach in more detail.</li>
</ul>
<h4 id="slow-image-generation">Slow image generation</h4>
<p>Generating images from text in diffusion models is slow for two main reasons. First, due to the sequential nature of the diffusion sampling process, multiple steps are needed to refine the image. Second, as diffusion models have billions of parameters, significant computations occur at each step.</p>
<p>Common strategies to mitigate this challenge include:</p>
<ul>
<li><strong>Parallel sampling:</strong> Implementing parallel processing during sampling reduces the time needed to generate images [25].</li>
<li><strong>Model distillation:</strong> A distilled model improves generation speed because of its reduced size, but it retains the behavior and performance of the original model. To learn more about model distillation in diffusion models, refer to [26].</li>
<li><strong>Model quantization:</strong> This technique reduces the precision of the model's weights, which decreases memory usage and speeds up generation.</li>
</ul>
<h2 id="evaluation">Evaluation</h2>
<h3 id="offline-evaluation-metrics">Offline evaluation metrics</h3>
<p>A consistent and reliable benchmark is key to evaluating text-to-image models. DrawBench [17] serves this purpose by providing a curated set of prompts that test various aspects of image generation such as object composition, interaction, and context understanding. These prompts, ranging from simple to complex, help to assess how accurately the model generates images from text. Due to its comprehensiveness, we use DrawBench to evaluate our text-to-image model. Let’s examine both automated metrics and human evaluation to assess three key areas of the model’s ability to generate images:</p>
<ul>
<li>Image quality</li>
<li>Image diversity</li>
<li>Image–text alignment</li>
</ul>
<p>As discussed in previous chapters, Inception score (IS) [27] and Fréchet Inception distance (FID) [28] are two common metrics for evaluating quality and diversity in image generation systems. In this section, we focus primarily on image–text alignment.</p>
<h4 id="imagetext-alignment">Image–text alignment</h4>
<p>Image–text alignment refers to how accurately the generated images match the text prompts. Measuring this alignment is important because it ensures the generated images are faithful to the user's input. A common metric for assessing this is CLIPScore [29], which evaluates the degree of alignment. Before diving into CLIPScore, let's briefly review CLIP.</p>
<h5 id="clip">CLIP</h5>
<p>CLIP [8] is a model developed by OpenAI that has been trained to match images with their corresponding descriptions. It consists of two encoders: one for text and one for images. The text encoder converts input text into a text embedding; the image encoder converts the image into an image embedding.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the functionality of a CLIP (Contrastive Language–Image Pre-training) model.  The diagram is enclosed within a dashed-line box labeled 'CLIP model'.  On the left, an image depicting a sailboat on the ocean is shown, and the text 'A boat on an oc...' is displayed, indicating a textual description of the image.  Arrows indicate that both the image and the text are fed as input into the CLIP model. Inside the CLIP model, two rectangular boxes represent the processing of the image and text data separately. A light purple box labeled 'Text...' receives the textual input ('A boat on an oc...'), and a light green box labeled 'Image...' receives the image input (the sailboat picture).  Each of these boxes then outputs data to a series of adjacent rectangular blocks, representing the feature vectors generated by the model for the text and image respectively.  The arrows show the flow of information from the input (image and text) through the CLIP model's processing blocks to the final feature vector representations.  The bottom of the diagram includes a note stating 'Text is not SVG - cannot display,' indicating that the text description is not displayed as a visual SVG element." loading="lazy" width="352" height="200" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-16-FBA7BGBF.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 16: CLIP encoders</figcaption></div></figure>
<p>During training, CLIP learns to align embeddings by bringing related text and image embeddings closer together and pushing unrelated ones apart. This helps CLIP develop a shared embedding space where both an image and its associated text will map into the same space.</p>
<p>After training, similar text descriptions map close to each other in the embedding space, and images map near their relevant descriptions.<sup><a id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fn-4">4</a></sup></p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a diagram illustrating the functionality of a CLIP (Contrastive Language–Image Pre-training) model.  Three text descriptions ('A boat on an ocean,' 'A boat in lake,' 'A train in c...') are fed as input into a purple rectangle labeled 'Text...', representing the text encoder part of the CLIP model.  Simultaneously, an image of a sailboat on the water is fed into a light green rectangle labeled 'Image...', representing the image encoder. Both the text and image encoders output their respective embeddings, shown as three and one horizontal arrays of smaller rectangles, respectively. These embeddings are then mapped into a 2D 'Embedding space,' represented by a graph with x and y axes.  The text embeddings are represented by three 'x' marks in the embedding space, each corresponding to one of the input text descriptions, and their positions relative to each other and the image embedding (represented by another 'x' mark) illustrate their semantic similarity. Dashed lines connect the output of each encoder to their corresponding points in the embedding space, showing the mapping process. The overall diagram demonstrates how CLIP encodes both text and image inputs into a shared embedding space, allowing for comparison and similarity assessment." loading="lazy" width="630" height="268" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-17-BXSJL66Y.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 17: Text and image feature vectors mapped to the CLIP embedding space</figcaption></div></figure>
<p>With an understanding of the CLIP model, we can now easily explore CLIPScore as a metric for evaluating image–text alignment.</p>
<h5 id="clipscore">CLIPScore</h5>
<p>The CLIPScore measures the cosine similarity between the CLIP embeddings of a text description and an image. It shows how closely the image matches the text in the high-dimensional embedding space. A higher score indicates better alignment between an image and a description.</p>
<h4 id="human-evaluation">Human evaluation</h4>
<p>Human evaluation complements the automated metrics by assessing both image quality and text alignment using the following approach:</p>
<ul>
<li><strong>Image quality:</strong> Human raters compare a generated image with a reference image by judging which of the images is more photorealistic. Image quality is determined by the percentage of times the generated image is chosen over the reference image.</li>
<li><strong>Text alignment:</strong> Human raters are shown an image and its caption and then asked, "<em>Does the caption accurately describe the above image?</em>" The responses "<em>yes,</em>" "<em>somewhat,</em>" and "<em>no</em>" are scored as 100, 50, and 0, respectively. These scores are averaged separately for generated images and reference images to measure text alignment.</li>
</ul>
<h3 id="online-evaluation-metrics">Online evaluation metrics</h3>
<p>Online metrics measure how the model works in production. Common metrics to evaluate our text-to-image model include:</p>
<ul>
<li><strong>Click-through rate (CTR):</strong> The percentage of users who click on the generated images. A high CTR indicates that users find the generated images useful.</li>
<li><strong>Time spent on page:</strong> The average time users spend with the service. Longer viewing times indicate higher user engagement.</li>
<li><strong>User feedback:</strong> Direct feedback from users is collected through feedback. Positive feedback indicates satisfaction with the image quality and text alignment.</li>
<li><strong>Conversion rate:</strong> The percentage of users who take a desired action (e.g., purchase, sign up) after interacting with generated images. A high conversion rate indicates satisfaction with the model's performance.</li>
<li><strong>Latency:</strong> The time it takes to generate an image from a text prompt. Lower latency indicates faster performance, which is important for user satisfaction.</li>
<li><strong>Throughput:</strong> The number of image generations the model can handle per second. High throughput ensures the service can serve more users.</li>
<li><strong>Resource utilization:</strong> The computational resources (e.g., CPU, GPU, memory) used to run the model and serve users. Efficient resource utilization is key to reducing costs.</li>
<li><strong>Average cost per user per month:</strong> Generating images with models that have billions of parameters is costly. If users are unhappy with the images, they might repeatedly generate new ones using the same prompt but different seeds, hoping for better results. This behavior increases our expenses. By monitoring this metric, we can ensure that costs remain justifiable.</li>
</ul>
<h2 id="overall-ml-system-design">Overall ML System Design</h2>
<p>While the diffusion model is at the core of a text-to-image generation system, several other pipelines are crucial for ensuring efficiency, safety, and quality. In this section, we delve into the holistic design of a text-to-image generation system by examining the following pipelines:</p>
<ul>
<li>Data pipeline</li>
<li>Training pipeline</li>
<li>Model optimization pipeline</li>
<li>Inference pipeline</li>
</ul>
<h3 id="data-pipeline">Data pipeline</h3>
<p>The data pipeline prepares data for training by removing inappropriate images, standardizing the rest, and storing them. It ensures captions are present and relevant and uses a pretrained model such as Google’s T5 [9] to pre-compute and cache caption embeddings. This caching reduces computation during training.</p>
<p>In addition to preparing text–image pairs from the training data, the pipeline also collects and processes newly generated data such as user prompts, generated images, and user feedback. This new data is added to the training set for future use.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a data processing pipeline with two parallel branches.  The top branch processes raw image data.  Two cylindrical database-like structures labeled 'Raw...' and 'User-generated...' represent input sources.  Data from these sources flows into a light green rectangular box labeled 'Inappropriate...', suggesting an initial filtering or moderation step.  The output then flows into another light green box labeled 'Image...', implying image processing or transformation. Finally, the processed image data is stored in a cylindrical database labeled 'Prepared...'. The bottom branch processes user-generated captions.  Data from a 'Raw...' database flows into a purple rectangular box labeled 'Caption Enhancer,' likely for improving the quality or clarity of the captions.  The enhanced captions then move to another purple box labeled 'Caption Encoder...', suggesting a process of converting the captions into a suitable format for storage or further processing.  The encoded captions are then stored in a cylindrical database labeled 'Caption...'.  Both branches are independent but process data originating from similar sources, suggesting a system designed to handle both image and caption data from user-generated content." loading="lazy" width="523" height="341" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-18-SKS5QNJI.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 18: Data pipeline</figcaption></div></figure>
<h3 id="training-pipeline">Training pipeline</h3>
<p>The training pipeline trains a model using the latest training data collected by the data pipeline.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a data processing pipeline for training a diffusion model.  Two cylindrical database-like components, labeled 'Prepared...' and 'Caption...', represent input data sources.  These sources are connected via lines to a rectangular 'Model Trainer' component, indicating that data from both 'Prepared...' and 'Caption...' are fed into the Model Trainer. The Model Trainer processes this combined input data and outputs a trained model, represented by an arrow pointing to a cloud-shaped component labeled 'Diffusion...', symbolizing the deployment of the trained diffusion model to a cloud environment.  The overall flow depicts the training process, where data from two sources are used to train a model which is then deployed." loading="lazy" width="332" height="180" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-19-KFI7RXYV.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 19: Training pipeline</figcaption></div></figure>
<p>The training pipeline ensures that the model adapts to recent user prompts and is trained on higher-quality generated images.</p>
<h3 id="evaluation-pipeline">Evaluation pipeline</h3>
<p>The evaluation pipeline assesses newly trained models using predefined automated metrics to determine whether or not they meet performance and quality standards for deployment.</p>
<h3 id="model-optimization-pipeline">Model optimization pipeline</h3>
<p>The model optimization pipeline is responsible for enhancing the efficiency of the model. There are several methods to optimize models:</p>
<ul>
<li><strong>Model compression:</strong> Use techniques such as quantization and pruning to reduce model size and generation time.</li>
<li><strong>Model distillation:</strong> Distill the model into a smaller one to reduce the model size and generation time.</li>
<li><strong>Optimized algorithms:</strong> Replace sampling with more efficient algorithms for faster generation.</li>
</ul>
<p>Once the model optimization is completed, the optimized model can replace the existing model in production.</p>
<h3 id="inference-pipeline">Inference pipeline</h3>
<p>The inference pipeline handles user requests and generates images based on text prompts. It comprises several components, each playing an important role in ensuring the system's quality and safety. In this section, we will examine the key components:</p>
<ul>
<li>Prompt auto-complete</li>
<li>Prompt safety service</li>
<li>Prompt enhancement</li>
<li>Image generation</li>
<li>Harm detection</li>
<li>Super-resolution service</li>
</ul>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a flowchart depicting the process of generating an image from a text prompt.  The process begins with a user typing a prompt (1) and submitting it (2) to a 'Prompt Safety...' module (a light-red rectangle) which checks if the prompt is safe.  If safe (3a), the prompt proceeds to a 'Prompt...' module (a light-purple rectangle) (4), then to an 'Image...' module (a light-gold rectangle) (6). The 'Image...' module receives input from both 'Text...' and 'Diffusion...' modules (represented by grey clouds) via connections labeled (5a) and (5b) respectively. The generated image then passes through a 'Harm...' module (a light-red rectangle) (6) for safety checks. If safe (7a), it proceeds to a 'Super-Resolution...' module (a light-blue rectangle) (8), resulting in a final generated image.  If at any point a safety check fails (3b or 7b), the request is rejected.  The entire process is numbered sequentially, indicating the order of operations." loading="lazy" width="640" height="292" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-20-MCBVLGYN.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 20: Inference pipeline</figcaption></div></figure>
<h4 id="prompt-auto-complete-service">Prompt auto-complete service</h4>
<p>The prompt auto-complete service uses a specialized model to suggest possible next words or phrases in real-time as the user types their prompt. This enhances user experience by providing potential completions.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simple user interface for a text-to-image generation system.  The main component is a large rectangular box divided into three horizontal sections, each containing a text prompt: 'A dog sitting in the backyard,' 'A dolphin jumping out of the water,' and 'A dog drawing another dog.'  Above these prompts, a smaller section displays 'A do,' suggesting an incomplete or initial prompt. To the right of the main box is a separate rectangular button labeled 'Generate.'  The implied interaction is that a user would complete the prompt in the top section (perhaps adding 'A dog'), select one or more of the prompts below, and then click the 'Generate' button to trigger the image generation process based on the selected text prompts.  No URLs or parameters are visible." loading="lazy" width="464" height="136" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-21-W236GIPQ.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 21: Suggested phrases by the auto-complete service</figcaption></div></figure>
<h4 id="prompt-safety-service">Prompt safety service</h4>
<p>This service uses a text classification model to process user prompts and reject those that violate our usage policies, for example, requests for violence, hateful imagery, or nudity.</p>
<p>This service ensures that the system adheres to safety standards and prevents the generation of inappropriate images.</p>
<h4 id="prompt-enhancement">Prompt enhancement</h4>
<p>The prompt enhancement component refines user prompts to improve their clarity, coherence, and details.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simple data flow diagram illustrating prompt enhancement in a generative AI system.  The diagram shows an initial prompt, 'A dog sitting,' as the input. This prompt flows via a directed arrow into a rectangular box labeled 'Prompt Enhanceme...' (presumably short for 'Prompt Enhancement'), representing a process that refines the input.  This process outputs an enhanced prompt, 'A golden retriever dog sitting on a grassy field. The do...', which is shown flowing out of the 'Prompt Enhanceme...' box via another directed arrow. The output is a more detailed and specific description compared to the initial input, suggesting the addition of breed, location, and potentially further details implied by the ellipsis.  The overall flow demonstrates how a basic prompt is transformed into a richer, more descriptive prompt suitable for generating a more specific and detailed image or text." loading="lazy" width="608" height="124" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-22-G65RYMT6.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 22: An example of prompt enhancement</figcaption></div></figure>
<p>This component is widely used in advanced image and video generation systems [30], as it effectively helps the model produce better outputs. It improves the quality of generated images by offering the model a more coherent and detailed prompt.</p>
<h4 id="image-generation">Image generation</h4>
<p>The image generation component is the core of the inference pipeline. It interacts with the T5 text encoder to encode the enhanced text prompt into a sequence of tokens. These tokens are passed to the diffusion model to generate one or multiple images for each prompt.</p>
<h4 id="harm-detection">Harm detection</h4>
<p>This component ensures that generated images are safe for users. If an image still contains violence or nudity despite previous safeguards, the component flags it and blocks it from being shown.</p>
<h4 id="super-resolution-service">Super-resolution service</h4>
<p>The super-resolution service increases the resolution of the generated images. This step ensures that the final output is visually appealing and meets resolution requirements.</p>
<p>In practice, text-to-image systems often use at least one super-resolution model because diffusion models typically cannot generate high-resolution images directly. Instead, the diffusion model is trained at a lower resolution, and specialized super-resolution models enhance the resolution. For example, the base model might generate a 64x64 image, which a first super-resolution model increases to 256x256, followed by a second model that boosts it to 1024x1024. Google's [31] follows this approach to achieve the desired resolution.</p>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a data processing pipeline, visualized as a sequence of connected boxes and arrows.  The pipeline begins with a box labeled 'image generated b...' representing an input image. This image is fed into a light-blue, rounded-rectangle box labeled 'Super-Resolution #1...', which processes the image, presumably enhancing its resolution. The output of this first super-resolution step flows via a black arrow into an empty square box, acting as an intermediate stage.  From this intermediate stage, another arrow points to a second light-blue, rounded-rectangle box labeled 'Super-Resolution #2...', indicating a second super-resolution processing step. The output of this second step is then passed through a final arrow into a large, empty square box labeled 'Final...', representing the final, high-resolution output image.  The overall flow is linear, with data moving sequentially through the super-resolution stages." loading="lazy" width="602" height="162" decoding="async" data-nimg="1" src="https://bytebytego.com/images/courses/genai-system-design-interview/text-to-image-generation/figure-9-23-YHAFPZV3.svg" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 23: A cascade of super-resolution models</figcaption></div></figure>
<p>In summary, various pipelines work together to ensure that a text-to-image system is reliable, high-quality, and safe. The data pipeline provides the foundation for continuous improvement, while the training and model optimization pipelines enhance the model's performance. The inference pipeline ensures safe, efficient, and high-quality image generation. These pipelines create a system ready for real-world challenges.</p>
<h2 id="other-talking-points">Other Talking Points</h2>
<p>If time permits at the end of the interview, consider discussing these additional topics:</p>
<ul>
<li>Using consistency models for faster image generation [26].</li>
<li>Employing RLHF for quality improvement [32].</li>
<li>Extending the text-to-image model to support inpainting and outpainting applications [33].</li>
<li>Personalizing the text-to-image model to a particular concept (Chapter 10).</li>
<li>Details of different scheduling techniques [34].</li>
<li>Details of DDPM and DDIM, including their theoretical foundations [20][18].</li>
<li>Supporting multiple aspect ratios and resolutions using techniques such as Patch n’ Pack [35].</li>
<li>Details of developing a re-captioning model [36][37][13].</li>
<li>Improving the diversity–fidelity trade-off with guidance [19].</li>
<li>More advanced controls over the generated images using techniques like ControlNet [38].</li>
<li>Controlling the style of the generated images [39].</li>
</ul>
<h2 id="summary">Summary</h2>
<figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a mind map summarizing the key aspects of a generative AI system design interview.  The central node is labeled 'Summary,' branching into five main categories represented by colored lines:  orange ('Clarifying requirements' and 'Other talking points'), light-coral ('Model development' and 'Evaluation'), light-blue ('Specifying input and output'), purple ('Data preparation'), and teal ('Overall system components').  The 'Model development' branch further subdivides into 'Architecture' (detailing U-Net, Diffusion, downsampling/upsampling blocks, patchify/unpatchify, positional encoding, and transformer components), 'Training' (including diffusion process specifics like forward/backward passes and MSE loss), and 'Sampling' (covering CFG and DDIM methods).  It also includes 'Challenges and mitigations' addressing mixed precision training, data and model parallelism, and latent diffusion models. The 'Evaluation' branch splits into 'Offline' (covering image quality, diversity, image-text alignment using CLIP scores, and human evaluation) and 'Online' (focusing on conversion rate, latency, throughput, and resource utilization).  The 'Overall system components' branch details the data, training, evaluation, and optimization pipelines, as well as the inference pipeline, which includes prompt auto-complete, safety service, enhancement, image generation, harm detection, and super-resolution services.  The 'Clarifying requirements' branch specifies framing the problem as an ML task and choosing between autoregressive and diffusion models.  Finally, the 'Data preparation' branch focuses on image and caption preparation.  The entire diagram visually depicts the interconnectedness of various stages, from initial requirements to final system deployment and evaluation metrics." loading="lazy" width="641" height="1055" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(641px, 100vw), (max-width: 1200px) min(641px, 80vw), min(641px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fgenai-system-design-interview%2Ftext-to-image-generation%2Fimage-9-1-SPQVEECI.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></figure>
<h2 id="reference-material">Reference Material</h2>
<p>[1] OpenAI’s DALL-E 3. <a href="https://openai.com/index/dall-e-3/" target="_blank" rel="noopener noreferrer">https://openai.com/index/dall-e-3/</a>.<br>
[2] Imagen 3. <a href="https://arxiv.org/abs/2408.07009" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2408.07009</a>.<br>
[3] Adobe’s Firefly. <a href="https://www.adobe.com/products/firefly.html" target="_blank" rel="noopener noreferrer">https://www.adobe.com/products/firefly.html</a>.<br>
[4] Introducing ChatGPT. <a href="https://openai.com/index/chatgpt/" target="_blank" rel="noopener noreferrer">https://openai.com/index/chatgpt/</a>.<br>
[5] Zero-Shot Text-to-Image Generation. <a href="https://arxiv.org/abs/2102.12092" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2102.12092</a>.<br>
[6] Muse: Text-To-Image Generation via Masked Generative Transformers. <a href="https://arxiv.org/abs/2301.00704" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2301.00704</a>.<br>
[7] Generative Modeling by Estimating Gradients of the Data Distribution. <a href="https://arxiv.org/abs/1907.05600" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1907.05600</a>.<br>
[8] Learning Transferable Visual Models From Natural Language Supervision. <a href="https://arxiv.org/abs/2103.00020" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2103.00020</a>.<br>
[9] Exploring the Limits of Transfer Learning with a Unified Text-to-Text Transformer. <a href="https://arxiv.org/abs/1910.10683" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1910.10683</a>.<br>
[10] Hierarchical Text-Conditional Image Generation with CLIP Latents. <a href="https://arxiv.org/abs/2204.06125" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2204.06125</a>.<br>
[11] High-Resolution Image Synthesis with Latent Diffusion Models. <a href="https://arxiv.org/abs/2112.10752" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2112.10752</a>.<br>
[12] On the De-duplication of LAION-2B. <a href="https://arxiv.org/abs/2303.12733" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2303.12733</a>.<br>
[13] xGen-MM (BLIP-3): A Family of Open Large Multimodal Models. <a href="https://www.arxiv.org/abs/2408.08872" target="_blank" rel="noopener noreferrer">https://www.arxiv.org/abs/2408.08872</a>.<br>
[14] U-Net: Convolutional Networks for Biomedical Image Segmentation. <a href="https://arxiv.org/abs/1505.04597" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1505.04597</a>.<br>
[15] Scalable Diffusion Models with Transformers. <a href="https://arxiv.org/abs/2212.09748" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2212.09748</a>.<br>
[16] An Image is Worth 16x16 Words: Transformers for Image Recognition at Scale. <a href="https://arxiv.org/abs/2010.11929" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2010.11929</a>.<br>
[17] Photorealistic Text-to-Image Diffusion Models with Deep Language Understanding. <a href="https://arxiv.org/abs/2205.11487" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2205.11487</a>.<br>
[18] Denoising Diffusion Probabilistic Models. <a href="https://arxiv.org/abs/2006.11239" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2006.11239</a>.<br>
[19] Classifier-Free Diffusion Guidance. <a href="https://arxiv.org/abs/2207.12598" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2207.12598</a>.<br>
[20] Denoising Diffusion Implicit Models. <a href="https://arxiv.org/abs/2010.02502" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2010.02502</a>.<br>
[21] Introduction to Diffusion Models. <a href="https://lilianweng.github.io/posts/2021-07-11-diffusion-models/" target="_blank" rel="noopener noreferrer">https://lilianweng.github.io/posts/2021-07-11-diffusion-models/</a>.<br>
[22] Mixed Precision Training. <a href="https://arxiv.org/abs/1710.03740" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/1710.03740</a>.<br>
[23] FSDP tutorial. <a href="https://pytorch.org/tutorials/intermediate/FSDP_tutorial.html" target="_blank" rel="noopener noreferrer">https://pytorch.org/tutorials/intermediate/FSDP_tutorial.html</a>.<br>
[24] DeepSpeed. <a href="https://github.com/microsoft/DeepSpeed" target="_blank" rel="noopener noreferrer">https://github.com/microsoft/DeepSpeed</a>.<br>
[25] Parallel Sampling of Diffusion Models. <a href="https://arxiv.org/abs/2305.16317" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2305.16317</a>.<br>
[26] Consistency Models. <a href="https://arxiv.org/abs/2303.01469" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2303.01469</a>.<br>
[27] Inception score. <a href="https://en.wikipedia.org/wiki/Inception_score" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Inception_score</a>.<br>
[28] FID calculation. <a href="https://en.wikipedia.org/wiki/Fr%C3%A9chet_inception_distance" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Fr%C3%A9chet_inception_distance</a>.<br>
[29] CLIPScore: A Reference-free Evaluation Metric for Image Captioning. <a href="https://arxiv.org/abs/2104.08718" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2104.08718</a>.<br>
[30] Sora overview. <a href="https://openai.com/index/video-generation-models-as-world-simulators/" target="_blank" rel="noopener noreferrer">https://openai.com/index/video-generation-models-as-world-simulators/</a>.<br>
[31] Imagen Video: High Definition Video Generation with Diffusion Models. <a href="https://arxiv.org/abs/2210.02303" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2210.02303</a>.<br>
[32] Finetune Stable Diffusion Models with DDPO via TRL. <a href="https://huggingface.co/blog/trl-ddpo" target="_blank" rel="noopener noreferrer">https://huggingface.co/blog/trl-ddpo</a>.<br>
[33] Kandinsky: an Improved Text-to-Image Synthesis with Image Prior and Latent Diffusion. <a href="https://arxiv.org/abs/2310.03502" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2310.03502</a>.<br>
[34] On the Importance of Noise Scheduling for Diffusion Models. <a href="https://arxiv.org/abs/2301.10972" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2301.10972</a>.<br>
[35] Patch n' Pack: NaViT, a Vision Transformer for any Aspect Ratio and Resolution. <a href="https://arxiv.org/abs/2307.06304" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2307.06304</a>.<br>
[36] InternVL: Scaling up Vision Foundation Models and Aligning for Generic Visual-Linguistic Tasks. <a href="https://arxiv.org/abs/2312.14238" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2312.14238</a>.<br>
[37] BLIP-2: Bootstrapping Language-Image Pre-training with Frozen Image Encoders and Large Language Models. <a href="https://arxiv.org/abs/2301.12597" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2301.12597</a>.<br>
[38] Adding Conditional Control to Text-to-Image Diffusion Models. <a href="https://arxiv.org/abs/2302.05543" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2302.05543</a>.<br>
[39] StyleDrop: Text-to-image generation in any style. <a href="https://research.google/blog/styledrop-text-to-image-generation-in-any-style/" target="_blank" rel="noopener noreferrer">https://research.google/blog/styledrop-text-to-image-generation-in-any-style/</a>.</p>
<section data-footnotes="true" class="footnotes"><h2 class="sr-only" id="footnote-label">Footnotes</h2>
<ol>
<li id="user-content-fn-1">
<p>In practice, we provide the diffusion model with additional conditioning inputs, such as the timestep. This will be discussed further in the training section. <a data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fnref-1">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>For simplicity, we omitted the timestep input to the diffusion model. This will be covered in more detail in the training section. <a data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fnref-2">↩</a></p>
</li>
<li id="user-content-fn-3">
<p>For simplicity, we include only the noisy image, xt, and the timestep, t, as the input. As mentioned earlier, conditioning signals can also be included as inputs. <a data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fnref-3">↩</a></p>
</li>
<li id="user-content-fn-4">
<p>For simplicity, the embedding space is visualized in 2D. In reality, it is a d-dimensional space, where d represents the embedding size. <a data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref" href="/courses/genai-system-design-interview/text-to-image-generation#user-content-fnref-4">↩</a></p>
</li>
</ol>
</section>
        </article>
    </main>

    <div class="nav">
        <a href="../genai-system-design-interview.html">← Course Contents</a>
        <a href="high-resolution-image-synthesis.html">← Previous</a>
        <a href="personalized-headshot-generation.html">Next →</a>
    </div>

    <footer class="metadata">
        <p>Scraped on 10/10/2025</p>
    </footer>
</body>
</html>