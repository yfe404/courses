<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmful Content Detection - Machine Learning System Design Interview</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Open Sans', Arial, sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color: #454545;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

h1 {
    font-size: 2em;
    margin: 1em 0 0.5em 0;
    line-height: 1.2;
}

h2 {
    font-size: 1.5em;
    margin: 1.2em 0 0.6em 0;
    line-height: 1.3;
}

h3 {
    font-size: 1.2em;
    margin: 1em 0 0.5em 0;
    line-height: 1.4;
}

p {
    margin: 0.8em 0;
}

a {
    color: #0077aa;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

ul, ol {
    margin: 0.8em 0;
    padding-left: 2em;
}

li {
    margin: 0.4em 0;
}

code, pre {
    background: #f4f4f4;
    border: 1px solid #ddd;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}

code {
    padding: 2px 5px;
}

pre {
    padding: 10px;
    overflow-x: auto;
    margin: 1em 0;
}

pre code {
    border: none;
    padding: 0;
}

img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 1.5em auto;
}

figure {
    margin: 1.5em 0;
    text-align: center;
}

figcaption {
    font-style: italic;
    font-size: 0.9em;
    color: #666;
    margin-top: 0.5em;
}

.chapter-number {
    font-weight: bold;
    color: #0077aa;
}

.nav {
    margin: 2em 0;
    padding: 1em 0;
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
}

.nav a {
    margin-right: 1em;
}

.toc {
    list-style: none;
    padding: 0;
}

.toc li {
    margin: 0.8em 0;
}

.course-section {
    margin: 2em 0;
}

.course-title {
    font-size: 1.3em;
    font-weight: bold;
    color: #0077aa;
    margin: 1.5em 0 0.8em 0;
}

.metadata {
    font-size: 0.9em;
    color: #888;
    margin: 2em 0 1em 0;
}

.breadcrumb {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 1em;
}

.breadcrumb a {
    color: #0077aa;
}

@media (max-width: 600px) {
    body {
        padding: 10px;
    }

    h1 {
        font-size: 1.5em;
    }

    h2 {
        font-size: 1.3em;
    }
}</style>
</head>
<body>
    <div class="breadcrumb">
        <a href="../../index.html">Home</a> /
        <a href="../machine-learning-system-design-interview.html">Machine Learning System Design Interview</a> /
        Harmful Content Detection
    </div>

    <div class="nav">
        <a href="../machine-learning-system-design-interview.html">← Course Contents</a>
        <a href="youtube-video-search.html">← Previous</a>
        <a href="video-recommendation-system.html">Next →</a>
    </div>

    <main>
        <h1>
            <span class="chapter-number">05</span> Harmful Content Detection
        </h1>

        <div class="metadata">
            <a href="https://bytebytego.com/courses/machine-learning-system-design-interview/harmful-content-detection" target="_blank" rel="noopener">Original source</a>
        </div>

        <article>
            <header><strong class="style_chapter__grtAe">05</strong><h1>Harmful Content Detection</h1></header><p>Many social media platforms such as Facebook [1], LinkedIn [2], and Twitter [3] have standard guidelines to enforce integrity and make their platforms safe for users. These guidelines prohibit certain user behaviors, activities, and content that are harmful to the community. It is essential to have technologies and resources in place to identify harmful content and bad actors.
We can divide the focus of integrity enforcement into two categories:</p>
<ul>
<li>Harmful content: Posts that contain violence, nudity, self-harm, hate speech, etc.</li>
<li>Bad acts/bad actors: Fake accounts, spam, phishing, organized unethical activities, and other unsafe behaviors.</li>
</ul>
<p>In this chapter, we focus on detecting posts that might contain harmful content. In particular, we design a system that proactively monitors new posts, detects harmful content, and removes or demotes them if the content violates the platform's guidelines. To understand how companies build a harmful content detection system in practice, refer to [4] [5] [6].</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a system for detecting harmful content.  Four rectangular boxes, each representing a data record, are depicted. Each record contains a user icon, several text fields (likely representing user information and content details), a video camera icon, and a mountain icon (possibly indicating image or video content).  Two records are marked with a green checkmark, indicating they are classified as 'Benign,' while two are marked with a red 'X', indicating classification as 'Harmful.' A separate box displays the labels '✓ Benign' and '× Harmful' for clarity. Arrows connect the data records to a central cloud-shaped component labeled 'Harmful content detection system,' illustrating the flow of data into and out of the system for classification. The system processes the input data records and outputs a classification (benign or harmful) for each." width="886" height="411" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(886px, 100vw), (max-width: 1200px) min(886px, 80vw), min(886px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-01-1-ROVCWIXC.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.1: Harmful content detection system</figcaption></div></figure></center>
<h3 id="clarifying-requirements">Clarifying Requirements</h3>
<p>Here is a typical interaction between a candidate and an interviewer.</p>
<p><strong>Candidate:</strong> Does the system detect both harmful content and bad actors?<br>
<strong>Interviewer:</strong> Both are equally important. For simplicity, let's focus on detecting harmful content only.</p>
<p><strong>Candidate:</strong> Should a post only contain text, or are images and videos allowed?<br>
<strong>Interviewer:</strong> The content of a post can be text, image, video, or any combination of these.</p>
<p><strong>Candidate:</strong> What languages are supported? Is it English only?<br>
<strong>Interviewer:</strong> The system should detect harmful content in various languages. For simplicity, assume we can use a pre-trained multilingual model to embed the textual content.</p>
<p><strong>Candidate</strong>: Which specific categories of harmful content are we looking to identify? I can think of violence, nudity, hate speech, misinformation, etc. Are there other harmful categories to consider?<br>
<strong>Interviewer:</strong> Great, you brought up the major ones. Misinformation is more complex and controversial. For simplicity, let's not focus on misinformation.</p>
<p><strong>Candidate</strong>: Are there any human annotators available to label posts manually?<br>
<strong>Interviewer:</strong> The platform receives more than 500 million posts each day. Asking humans to label all of them would be very expensive and time-consuming. However, you can assume human annotation is available to label a limited number of posts, say 10,000 per day.</p>
<p><strong>Candidate:</strong> Allowing users to report harmful content is beneficial for understanding where the system is failing. Can I assume the system has that feature?<br>
<strong>Interviewer:</strong> Good point. Yes, users can report harmful posts.</p>
<p><strong>Candidate:</strong> Should we explain why a post is deemed harmful and removed?<br>
<strong>Interviewer:</strong> Yes. Explaining to users why we remove a post is essential. It helps users to ensure they align their future posts with the guidelines.</p>
<p><strong>Candidate:</strong> What is the system's latency requirement? Do we need a real-time prediction, i.e., the system detects harmful content immediately and blocks it, or can we rely on batch prediction, i.e., detecting harmful content offline hourly or daily?<br>
<strong>Interviewer:</strong> This is a very important question. What are your thoughts?</p>

<p><strong>Candidate:</strong> In my opinion, the requirements for different harmful content might vary. For example, violent content may require real-time solutions, while for others, late detection may work.<br>
<strong>Interviewer:</strong> Those are fair assumptions.</p>
<p>So, let's summarize the problem statement. We will design a harmful content detection system, which identifies harmful posts, then deletes or demotes them and informs the user why the post was identified as harmful. A post's content can be text, image, video, or any combination of these, and the content can be in different languages. Users can report harmful posts.</p>
<h3 id="frame-the-problem-as-an-ml-task">Frame the Problem as an ML Task</h3>
<h4 id="defining-the-ml-objective">Defining the ML objective</h4>
<p>We define our ML objective as accurately predicting harmful posts. The reason is that if we can accurately detect harmful posts, we can remove or demote them, leading to a safer platform.</p>
<h4 id="specifying-the-systems-input-and-output">Specifying the system's input and output</h4>
<p>The system receives a post as input, and outputs the probability that the post is harmful.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 120px; height: 346px;"><img alt="Image represents a simplified model of a harmful content detection system.  At the bottom is a rectangular box labeled 'Post P,' depicting a social media post containing a user icon (a small person symbol), a text input field (represented by a blank rectangle), three lines suggesting text or other content, and an image (represented by a stylized mountain icon).  An upward arrow connects this 'Post P' box to a larger rectangular box labeled 'Harmful content detection system.' This arrow indicates that the post's content is fed into the system for analysis.  Finally, another upward arrow connects the 'Harmful content detection system' box to a smaller square box containing the number '0.95.' This number likely represents the system's output, a probability score (0.95 or 95%) indicating a high likelihood of the post containing harmful content.  The entire diagram illustrates the flow of information from a social media post through a content detection system to a final probability score." loading="lazy" width="120" height="346" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(120px, 100vw), (max-width: 1200px) min(120px, 80vw), min(120px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-02-1-BJSVLTF6.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.2: A harmful content detection system’s input-output</figcaption></div></figure></center>
<p>Let’s dive deeper into the input post. As shown in Figure 5.3, a post can be heterogeneous and potentially multimodal.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 300px; height: 296px;"><img alt="Image represents a data model for a social media post, labeled 'Post P'.  Three distinct data components—'Image', 'Text', and 'Author'—are depicted as separate rectangular boxes with dashed borders. Each box contains visual representations of their respective data types: 'Image' shows a stylized mountain range icon; 'Text' shows three horizontal lines representing multiple lines of text; and 'Author' displays a person icon followed by a blank space suggesting a username or identifier.  Arrows indicate the flow of data, showing that the 'Image', 'Text', and 'Author' components all contribute to the creation of 'Post P'.  Specifically, arrows point from each of 'Image', 'Text', and 'Author' to 'Post P', indicating that the final post incorporates data from all three sources.  'Post P' itself contains a smaller version of the mountain range image and several horizontal lines representing text, along with a person icon and a blank space for an author identifier, mirroring the structure of its constituent parts." loading="lazy" width="300" height="296" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(300px, 100vw), (max-width: 1200px) min(300px, 80vw), min(300px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-03-1-4W7DMAXE.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.3: Heterogeneous post data</figcaption></div></figure></center>
<p>To make accurate predictions, the system should consider all modalities. Let's discuss two commonly used fusing methods to combine heterogeneous data: late fusion and early fusion.</p>
<h5 id="late-fusion">Late fusion</h5>
<p>With late fusion, ML models process different modalities independently, then combine their predictions to make a final prediction. The figure below illustrates how late fusion works.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 331px; height: 516px;"><img alt="Image represents a harmful content detection system.  The system processes a social media 'Post P,' which contains an image, text, and author information.  These three components are fed into three separate models: Model 1 processes the image, Model 2 processes the text, and Model N processes author-related data.  Each model independently assesses the post for harmful content. The outputs of these individual models are then combined within a 'Fusion' module, which aggregates the results to generate a single 'Harmful probability' score.  This score represents the overall likelihood of the post containing harmful content, indicating the system's final assessment.  The dashed lines delineate the boundaries of the overall harmful content detection system and the individual data input components.  Arrows indicate the flow of information from the input data to the models, from the models to the fusion module, and finally, from the fusion module to the final harmful probability output." loading="lazy" width="331" height="516" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(331px, 100vw), (max-width: 1200px) min(331px, 80vw), min(331px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-04-1-ZXXZUOPW.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.4: Late fusion</figcaption></div></figure></center>
<p>The advantage of late fusion is that we can train, evaluate, and improve each model independently.</p>
<p>However, late fusion has two major disadvantages. First, to train these individual models, we need to have separate training data for each modality, which can be time-consuming and expensive.</p>
<p>Second, the combination of the modalities might be harmful, even if each is benign in isolation. This is frequently the case with memes that combine images and text. In these cases, late fusion fails to predict whether the content is harmful. This is because each modality is benign, so the models predict benignity when processing each modality. The fusion layer output is benign because the output of each separate modality is benign. But this is incorrect, as the combination of modalities can be harmful.</p>
<h5 id="early-fusion">Early fusion</h5>
<p>With early fusion, the modalities are combined first, and then the model makes a prediction. Figure 5.5 illustrates how early fusion works.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 331px; height: 516px;"><img alt="Image represents a harmful content detection system.  At the bottom, a 'Post P' box, depicted with dashed lines, contains an image (represented by two mountain peaks) and text (represented by three horizontal lines), along with an author icon and a blank space likely representing an author's name or identifier.  Arrows indicate that the image, text, and author information from 'Post P' are fed into three separate boxes above: 'Image,' 'Text,' and 'Author,' respectively. These three boxes, also outlined with dashed lines, represent the individual components of the post being analyzed.  The outputs from 'Image,' 'Text,' and 'Author' are then fed into a 'Fusion' box, which combines the information. The output of the 'Fusion' box is then fed into a 'Model' box, which processes the fused data. Finally, the 'Model' box outputs a 'Harmful probability,' represented by a simple box at the top, indicating the likelihood of the post containing harmful content. The entire system, from 'Image,' 'Text,' and 'Author' to 'Harmful probability,' is enclosed within a larger dashed-line box labeled 'Harmful content detection system.'" loading="lazy" width="331" height="516" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(331px, 100vw), (max-width: 1200px) min(331px, 80vw), min(331px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-05-1-E6HNOFG4.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.5: Early fusion</figcaption></div></figure></center>
<p>Early fusion has two major advantages. First, it is unnecessary to collect training data separately for each modality. Since there is a single model to train, we only need to collect training data for that model. Second, the model considers all the modalities, so if each modality is benign, but their combination is harmful, then the model can potentially capture this in the unified feature vector.</p>
<p>However, learning this task is more difficult for the model due to the complex relationships between modalities. In the absence of sufficient training data, it is challenging for the model to learn complex relationships and make good predictions.</p>
<h5 id="which-fusion-method-should-we-use">Which fusion method should we use?</h5>
<p>The early fusion method is used because it allows us to capture posts that may be harmful overall, even if each modality is benign on its own. Additionally, with around 500 million posts being published every day, the model has enough data to learn the task.</p>
<h4 id="choosing-the-right-ml-category">Choosing the right ML category</h4>
<p>In this section, we examine the following ML category options:</p>
<ul>
<li>Single binary classifier</li>
<li>One binary classifier per harmful class</li>
<li>Multi-label classifier</li>
<li>Multi-task classifier</li>
</ul>
<h5 id="single-binary-classifier">Single binary classifier</h5>
<p>In this option, a model takes the fused features as input and predicts the probability of the post being harmful (Figure 5.6). Since the output is a binary outcome, the model is a binary classifier.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 365px; height: 240px;"><img alt="Image represents a simplified machine learning model for predicting the harmful probability of some input.  At the bottom, a long horizontal rectangle labeled 'Fused features' represents the input data, depicted as a series of individual, equally sized, and uniformly spaced cells, suggesting multiple features combined into a single input vector.  An upward arrow indicates this input flows into a rectangular box labeled 'Model,' representing the core machine learning algorithm.  This model processes the fused features and outputs a prediction, shown by an upward arrow connecting the 'Model' box to a square box at the top labeled 'Harmful probability,' indicating the model's output is a probability score representing the likelihood of the input being harmful.  The diagram's simplicity focuses on the data flow: input features are fused, processed by the model, and result in a harmful probability prediction." loading="lazy" width="365" height="240" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(365px, 100vw), (max-width: 1200px) min(365px, 80vw), min(365px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-06-1-GAYWQ7X3.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.6: A single binary classifier</figcaption></div></figure></center>
<p>The shortcoming of this option is that it's difficult to determine which class of harm, such as violence, a post belongs to. This limitation causes two main issues:</p>
<ul>
<li>It is not easy to inform users why we take down a post as the system only outputs a binary value indicating whether the post as a whole is harmful or not. We have no clue which particular class of harm the post belongs to.</li>
<li>It is not easy to identify harmful classes in which the system doesn't perform well, meaning we cannot improve the system for underperforming classes.</li>
</ul>
<p>Since it is essential to explain why a post is removed, a single binary classifier is not a good option.</p>
<h5 id="one-binary-classifier-per-harmful-class">One binary classifier per harmful class</h5>
<p>In this option, we adopt one binary classifier for each harmful class. As Figure <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.7</mn></mrow><annotation encoding="application/x-tex">5.7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.7</span></span></span></span> shows, each model determines if a post belongs to a specific harmful class or not. Each model takes fused features as input and predicts the probability of the post being classified as a harmful class.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 365px; height: 254px;"><img alt="Image represents a system for multi-class classification, likely for content moderation.  At the bottom, a horizontal rectangular block labeled 'Fused features' represents a combined set of input features.  Arrows point upwards from this block to N individual model blocks labeled 'Model 1,' 'Model 2,' ..., 'Model N.' Each of these models processes the fused features and outputs a probability score.  Above each model, a square box represents the output probability for a specific class: 'Violence probability,' 'Nudity probability,' and 'Hate probability' are shown, implying that at least three classes are being predicted.  The arrows indicate the flow of information: the fused features are input to each model, and each model's output (a probability score) is fed to its corresponding class probability box.  The system uses multiple models to predict the probability of different types of inappropriate content, suggesting an ensemble or parallel processing approach." loading="lazy" width="365" height="254" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(365px, 100vw), (max-width: 1200px) min(365px, 80vw), min(365px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-07-1-IUZCP5VM.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.7: One binary classifier per harmful class</figcaption></div></figure></center>
<p>The advantage of this option is that we can explain to users why a post was taken down. In addition, we can monitor different models and improve them independently.</p>
<p>However, this option has one major drawback. Since we have multiple models, they must be trained and maintained separately. Training these models separately is time-consuming and expensive.</p>
<h5 id="a-multi-label-classifier">A multi-label classifier</h5>
<p>In multi-label classification, the data point we want to classify may belong to an arbitrary number of classes. In this option, a single model is used as a multi-label classifier. As Figure <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.8</mn></mrow><annotation encoding="application/x-tex">5.8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.8</span></span></span></span> shows, the input to the model is the fused features, and the model predicts probabilities for each harmful class.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 365px; height: 254px;"><img alt="Image represents a machine learning model for content moderation.  At the bottom, a rectangular block labeled 'Fused features' represents the input data, depicted as a series of uniformly sized smaller rectangles suggesting multiple features combined. An arrow points upwards from this block to a central rectangular block labeled 'Model,' indicating that the fused features are fed into the model.  From the 'Model' block, three arrows point upwards to three separate square blocks, each labeled with a type of content and its associated probability: 'Violence probability,' 'Nudity probability,' and 'Hate probability.'  An ellipsis (...) between the 'Nudity probability' and 'Hate probability' blocks suggests the possibility of additional content categories beyond these three.  The arrows indicate that the model outputs the probability of each content type being present in the input data.  The overall structure shows a data flow from fused features to a model that then predicts probabilities for different types of potentially harmful content." loading="lazy" width="365" height="254" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(365px, 100vw), (max-width: 1200px) min(365px, 80vw), min(365px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-08-1-S3IY7HXM.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.8: A multi-label classifier</figcaption></div></figure></center>
<p>By using a shared model for all harmful classes, training and maintaining the model is less costly. If you would like to learn more about this method, refer to the approach called WPIE [7].</p>
<p>However, predicting the probabilities of each harmful class using a shared model isn’t ideal, as the input features may need to be transformed differently.</p>
<h5 id="multi-task-classifier">Multi-task classifier</h5>
<p>Multi-task learning refers to the process in which a model learns multiple tasks simultaneously. This allows the model to learn similarities between tasks. By doing so, we avoid unnecessary computations when a certain input transformation is beneficial for multiple tasks.</p>
<p>In our case, we treat different classes of harm, such as violence and nudity, as different tasks and use a multi-task classification model to learn each task. As Figure 5.9 shows, multi-task classification has two stages: shared layers and task-specific layers.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a multi-task learning model architecture for classifying content based on violence, nudity, and hate speech.  At the bottom, 'Fused features' are a vector of input features, which are processed by 'Shared layers'. The output of the shared layers, a transformed feature vector (shown as 0.9, -0.4, -0.1, 0, 1.2, -0.8, 0.77, 0.36, -0.98, 1), is then fed into three separate 'Task-specific layers', each with a 'classification head' dedicated to a specific task: violence, nudity, and hate detection.  Each task-specific layer processes the transformed features and outputs a probability score for its respective category ('Violence probability', 'Nudity probability', 'Hate probability').  The arrows indicate the flow of information, showing how the shared layers' output is used by each task-specific layer, and how each task-specific layer produces a probability score.  The ellipsis (...) indicates that more task-specific layers could be added to the model." loading="lazy" width="456" height="380" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(456px, 100vw), (max-width: 1200px) min(456px, 80vw), min(456px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-09-1-GWHRFHAQ.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.9: Multi-task classification overview</figcaption></div></figure></center>
<p><strong>Shared layers</strong>
A shared layer, as shown in Figure 5.10, is a set of hidden layers that transform input features into new ones. These newly transformed features are used to make predictions for each of the harmful classes.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simplified diagram of a machine learning model's architecture, specifically focusing on feature transformation and shared layers.  At the bottom, a horizontal array labeled 'Input features' depicts a sequence of input data points, represented by empty boxes.  An upward arrow connects this input layer to a rectangular box labeled 'Shared layers,' indicating that the input features are processed by these shared layers.  The output of the 'Shared layers' is then shown as another horizontal array at the top, labeled 'Transformed features.' This array contains numerical values (0.9, -0.4, -0.1, 0, 1.2, -0.8, 0.77, 0.36, -0.98, 1), representing the transformed features resulting from the processing within the 'Shared layers.'  The upward arrows illustrate the flow of data from the input features through the shared layers to the transformed features.  The diagram highlights the transformation of input features into a new representation using shared layers, a common technique in deep learning to extract relevant information from the input data." loading="lazy" width="456" height="160" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(456px, 100vw), (max-width: 1200px) min(456px, 80vw), min(456px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-10-1-ZKO4GCMD.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.10: Shared layers</figcaption></div></figure></center>
<p><strong>Task-specific layers</strong>
Task-specific layers are a set of independent ML layers (also called classification heads). Each classification head transforms features in a way that is optimal for predicting a specific harm probability.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a multi-task learning model architecture for content moderation.  At the bottom, a row labeled 'Transformed features' displays a vector of numerical features (0.9, -0.4, -0.1, 0, 1.2, -0.8, 0.77, 0.36, -0.98, 1). This feature vector is fed into a set of 'Task-specific layers' (represented by a dashed box), which are shared across multiple classification tasks.  Within this box are three classification heads: 'Violence classification head,' 'Nudity classification head,' and 'Hate classification head.' Each head processes the shared features and outputs a probability score for its respective task (Violence probability, Nudity probability, Hate probability).  These probability scores are displayed in separate boxes above their corresponding classification heads, indicating the model's prediction for each category.  Arrows illustrate the flow of information from the features to the shared layers and then to the individual classification heads, culminating in the final probability outputs for violence, nudity, and hate detection." loading="lazy" width="452" height="245" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(452px, 100vw), (max-width: 1200px) min(452px, 80vw), min(452px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-11-1-UFN5H4Y5.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.11: Task-specific layers</figcaption></div></figure></center>
<p>Multi-task classification has three advantages. First, it is not expensive to train or maintain since we use a single model. Second, the shared layers transform the features in a way that is beneficial for each task. This prevents redundant computations and makes multi-task classification efficient. Lastly, the training data for each task contributes to the learning of other tasks. This is especially helpful when limited data is available for a particular task.</p>
<p>Because of these advantages, we employ a multi-task classification method. Figure <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.12</mn></mrow><annotation encoding="application/x-tex">5.12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.12</span></span></span></span> shows how we frame the problem.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a multi-modal harmful content detection model.  At the bottom, a 'Post P' containing 'Image', 'Text', and 'Author' information is fed into a 'Fusion' layer, which combines these features into a single 'Fused features' vector. This vector is then processed by 'Shared layers', producing 'Transformed features'.  These transformed features are then fed into three separate 'Task-specific layers': 'Violence classification head', 'Nudity classification head', and 'Hate classification head'. Each head outputs a probability score ('Violence probability', 'Nudity probability', 'Hate probability') for its respective category. Finally, these individual probabilities are combined to produce an overall 'Harmful probability' score.  Numerical values (e.g., 0.9, -0.4, 1.2) are shown within the 'Transformed features' vector, representing the processed feature values. The dashed lines delineate distinct processing stages." loading="lazy" width="548" height="763" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(548px, 100vw), (max-width: 1200px) min(548px, 80vw), min(548px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-12-1-GCKNMDGB.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.12: Frame the problem as an ML task</figcaption></div></figure></center>
<h3 id="data-preparation">Data Preparation</h3>
<h4 id="data-engineering">Data engineering</h4>
<p>We have the following data available:</p>
<ul>
<li>Users</li>
<li>Posts</li>
<li>User-post interactions</li>
</ul>
<h5 id="users">Users</h5>
<p>A user data schema is shown below.</p>
<div class="table-wrap" style="--table-min-width: 640px;"><table><thead><tr><th style="text-align: center;"><strong>ID</strong></th><th style="text-align: center;"><strong>Username</strong></th><th style="text-align: center;"><strong>Age</strong></th><th style="text-align: center;"><strong>Gender</strong></th><th style="text-align: center;"><strong>City</strong></th><th style="text-align: center;"><strong>Country</strong></th><th style="text-align: center;"><strong>Email</strong></th></tr></thead></table></div>
<p class="tableCaption">Table 5.1: User data schema</p>
<h5 id="posts">Posts</h5>
<p>Post data contain fields such as author, time of upload, etc. Table <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.2</mn></mrow><annotation encoding="application/x-tex">5.2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.2</span></span></span></span> shows some of the most important attributes. In practice, we typically have hundreds of attributes associated with each post.</p>
<div class="table-wrap" style="--table-min-width: 640px;"><table><thead><tr><td><strong>Post ID</strong></td><td><strong>Author ID</strong></td><td><strong>On-device</strong></td><td><strong>Timestamp</strong></td><td><strong>Textual content</strong></td><td><strong>Images or videos</strong></td><td><strong>Links</strong></td></tr></thead><tbody><tr><td>1</td><td>1</td><td>73.93.220.240</td><td>1658469431</td><td>Today, I am starting my diet.</td><td>http: //cdn.mysite.com/u1.jpg</td><td>-</td></tr><tr><td>2</td><td>11</td><td>89.42.110.250</td><td>1658471428</td><td>The video amazed me! Please donate</td><td>http: //cdn.mysite.com/t3.mp4</td><td>gofundme.com/f/3u1njd32</td></tr><tr><td>3</td><td>4</td><td>39.55.180.020</td><td>1658489233</td><td>What is a good restaurant in the Bay area?</td><td>http: //cdn.mysite.com/t5.jpg</td><td>-</td></tr></tbody></table></div>
<p class="tableCaption">Table 5.2: Post data</p>
<h5 id="user-post-interactions">User-post interactions</h5>
<p>User-post interaction data primarily contain users' reactions to posts, such as likes, comments, saves, shares, etc. Users can also report a post as harmful or request an appeal. Table <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.3</mn></mrow><annotation encoding="application/x-tex">5.3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.3</span></span></span></span> shows what the data might look like.</p>
<div class="table-wrap" style="--table-min-width: 640px;"><table><thead><tr><th style="text-align: center;"><strong>User ID</strong></th><th style="text-align: center;"><strong>Post ID</strong></th><th style="text-align: center;"><strong>Interaction type</strong></th><th style="text-align: center;"><strong>Interaction value</strong></th><th style="text-align: center;"><strong>Timestamp</strong></th></tr></thead><tbody><tr><td style="text-align: center;">11</td><td style="text-align: center;">6</td><td style="text-align: center;">Impression</td><td style="text-align: center;">-</td><td style="text-align: center;">1658450539</td></tr><tr><td style="text-align: center;">4</td><td style="text-align: center;">20</td><td style="text-align: center;">Like</td><td style="text-align: center;">-</td><td style="text-align: center;">1658451341</td></tr><tr><td style="text-align: center;">11</td><td style="text-align: center;">7</td><td style="text-align: center;">Comment</td><td style="text-align: center;">This is disgusting</td><td style="text-align: center;">1658451365</td></tr><tr><td style="text-align: center;">4</td><td style="text-align: center;">20</td><td style="text-align: center;">Share</td><td style="text-align: center;">-</td><td style="text-align: center;">1658435948</td></tr><tr><td style="text-align: center;">11</td><td style="text-align: center;">7</td><td style="text-align: center;">Report</td><td style="text-align: center;">violence</td><td style="text-align: center;">1658451849</td></tr></tbody></table></div>
<p class="tableCaption">Table 5.3: User-post interaction data</p>
<h4 id="feature-engineering">Feature engineering</h4>
<p>In the "Frame the problem as an ML task" section, we framed the problem as a multitask classification task where the input is the post. In this section, we explore predictive features that can be derived from a post.
A post might comprise the following elements:</p>
<ul>
<li>Textual content</li>
<li>Image or video</li>
<li>User reactions to the post</li>
<li>Author</li>
<li>Contextual information</li>
</ul>
<p>Let's look at each element.</p>
<h5 id="textual-content">Textual content</h5>
<p>The textual content of a post can be used to determine whether a post is harmful or not. As described in Chapter 4 YouTube Video Search, text data is usually prepared in two steps:</p>
<ul>
<li>Text preprocessing (e.g., normalization, tokenization)</li>
<li>Vectorization: convert the preprocessed text into a meaningful feature vector
Let's focus on vectorization since it is unique to this chapter. To vectorize the text and extract a feature vector, statistical or ML-based methods can be used. Statistical methods such as BoW or TF-IDF are easy to implement and fast to compute. However, they cannot encode the semantics of the text. For our system, understanding the semantics of the textual content is important for determining harm, so we adopt the ML-based method. To convert text into a feature vector, we use a pre-trained Transformer-based language model such as BERT [8]. However, the original BERT has two issues:</li>
<li>Producing the text embedding takes a long time due to the large size of the model. Because this is a slow process, using it for online predictions is not ideal.</li>
<li>BERT was trained on English-only data. Thus, it does not produce meaningful embeddings for texts in other languages.</li>
</ul>
<p>DistilmBERT [9], a more efficient variant of BERT, addresses those two issues. If two sentences have the same meaning but are in two different languages, their embeddings are very similar. If you are interested to learn more about multilingual language models, refer to [10].</p>
<h5 id="image-or-video">Image or video</h5>
<p>You can usually find out what a post is about by looking at the image or video within it. The following two steps are commonly used to prepare unstructured data such as images or videos.</p>
<ul>
<li><strong>Preprocessing:</strong> decode, resize, and normalize the data.</li>
<li><strong>Feature extraction:</strong> after preprocessing, we use a pre-trained model to convert unstructured data to a feature vector. This allows us to represent an image or video by a feature vector. For images, a pre-trained image model such as CLIP's visual encoder [11] or SimCLR [12] are viable options. For videos, pre-trained models like VideoMoCo [13] might work well.</li>
</ul>
<h5 id="user-reactions-to-the-post">User reactions to the post</h5>
<p>It is also possible to determine whether a post is harmful based on user reactions, especially when the content is ambiguous. As shown in Figure 5.13, with more comments, it becomes increasingly evident the post contains content related to self-harm.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a smartphone screen displaying a social media post expressing suicidal ideation alongside a graph tracking the perceived harm confidence level over time.  The post, authored by 'Hamid and 35 others,' contains a distressing message indicating severe sadness and hopelessness. Below the post are three supportive comments from Jennifer Timonin, Davino Muriello, and Danny Pawson, each offering help and empathy.  The post includes standard social media interaction options: 'Like,' 'Comment,' and 'Share.' To the right, a line graph titled 'Harm Confidence' plots an upward trend over time, visually representing an increasing assessment of the user's potential for self-harm.  Pink circles mark data points on the graph, with each point corresponding to a time interval.  The graph also includes small chat bubbles and sad-faced emojis at various points, suggesting the correlation between the post's emotional content and the escalating harm confidence level.  The x-axis of the graph is labeled 'Time,' indicating the progression of the perceived risk." loading="lazy" width="712" height="540" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(712px, 100vw), (max-width: 1200px) min(712px, 80vw), min(712px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-13-1-LWFDENPP.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.13: Post with self-harm concern</figcaption></div></figure></center>
<p>Since user reactions are crucial in determining harmful content, let's examine some of the features we can engineer based on them.</p>
<p><strong>The number of likes, shares, comments, and reports:</strong> We usually scale these numerical values to speed up convergence during model training.</p>
<p><strong>Comments:</strong> As demonstrated in Figure 5.13, comments can help us identify harmful content. For feature preparation, we convert comments into numerical representations by doing the following:</p>
<ul>
<li>Use the same pre-trained model we employed earlier to obtain the embedding of each comment.</li>
<li>Aggregate (e.g., average) the embeddings to obtain a final embedding.</li>
</ul>
<p>A summary of the features we have described so far can be found in Figure 5.14.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a machine learning model for analyzing social media posts.  The bottom layer shows input data sources: 'Reactions' (with counts of #Reports, #Likes, #Comments, #Shares), and 'Content' (comprising 'Post's textual content,' 'Post's image,' and 'Post's video').  The 'Reactions' data is fed directly into a 'Scale' component. The 'Content' data is preprocessed separately for each modality (text, image, video) using 'Preprocess' blocks, then fed into corresponding pre-trained models ('Pre-trained text model,' 'Pre-trained image model,' 'Pre-trained video model'). Each pre-trained model outputs a vector of numerical features (e.g., 0.1, 0.8, 0.6, 0.3 for the text model).  These feature vectors, along with the scaled reaction counts from the 'Scale' component, are then aggregated using an 'Aggregate' block, which combines the features into a single vector. Finally, this aggregated vector is fed into a 'Concatenated features' block, representing the final feature representation of the post used for further processing (not shown in the diagram).  The numerical values within the boxes represent example feature values." loading="lazy" width="1007" height="644" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(1007px, 100vw), (max-width: 1200px) min(1007px, 80vw), min(1007px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-14-1-JEVGAY27.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.14: Feature engineering for reactions and content</figcaption></div></figure></center>
<h5 id="author-features">Author features</h5>
<p>The author's past interactions can be used to determine if the post is harmful or not. Let's engineer features related to the post author.</p>
<p><strong>Author's violation history</strong></p>
<ul>
<li><strong>Number of violations:</strong> This is a numerical value representing the number of times the author violated the guidelines in the past.</li>
<li><strong>Total user reports:</strong> A numerical value representing the number of times users reported the author's posts.</li>
<li><strong>Profane words rate:</strong> This is a numerical value representing the rate of profane words used in the author's previous posts and comments. A predefined list of profane words is used to determine whether a word is profane.</li>
</ul>
<p><strong>Author's demographics</strong></p>
<ul>
<li><strong>Age:</strong> A user's age is one of the most important predictive features.</li>
<li><strong>Gender:</strong> This categorical feature represents the user's gender. We use one-hot encoding to represent gender.</li>
<li><strong>City and country:</strong> Both the city and country take many distinct values. To represent the features, we use an embedding layer to convert city and country into feature vectors. Note that one-hot encoding is not an efficient method to represent the city and country because their representations would be long and sparse.</li>
</ul>
<p><strong>Account information</strong></p>
<ul>
<li><strong>Number of followers and followings</strong></li>
<li><strong>Account age:</strong> This is a numerical value representing the age of the author's account. This is a predictive feature as accounts with a lower age are more likely to be spam or to violate integrity.</li>
</ul>
<h5 id="contextual-information">Contextual information</h5>
<ul>
<li><strong>Time of day:</strong> This is the time of day when the author made a post. We bucketize this into multiple categories, such as morning, noon, afternoon, evening or night. We use one-hot encoding to represent this feature.</li>
<li><strong>Device:</strong> The device the author uses, such as a smartphone or desktop computer. One-hot encoding is used to represent this feature.</li>
</ul>
<p>Figure 5.15 summarizes some of the most important features of the harmful content detection system.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a multi-modal feature extraction and fusion system for a post (Post P).  The system begins with raw data inputs: an image, a video, text from the post itself, comments on the post, and author information. Each data type is processed by a corresponding pre-trained model: a pre-trained image model processes the image, a pre-trained video model processes the video, and a pre-trained text model processes both the post text and the comments.  The author information is processed by a separate 'Prepare author's features' module. Each pre-trained model outputs a feature vector. These feature vectors (Image feature vector, Video feature vector, Text feature vector, Comments feature vector, and Author feature vector) are then concatenated together. The resulting concatenated vector, representing the 'Fused features,' is the final output of the system.  Arrows indicate the flow of data, showing how raw data is transformed into feature vectors, which are then combined to create a comprehensive representation of the post." loading="lazy" width="550" height="625" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(550px, 100vw), (max-width: 1200px) min(550px, 80vw), min(550px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-15-1-RGPR34CR.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.15: Summary of feature engineering</figcaption></div></figure></center>
<h3 id="model-development">Model Development</h3>
<h4 id="model-selection">Model selection</h4>
<p>A neural network is the most common model used for multi-task learning. In developing our model, we employ neural networks.</p>
<p>When choosing a neural network, what factors should be considered? It is necessary to determine the neural network's architectural design and the optimal hyperparameter selection, such as its hidden layers, activation function, learning rate, etc. The optimal choice of hyperparameters is usually determined by hyperparameter tuning. Let's briefly go over it.</p>
<p>Hyperparameter tuning is the process of finding the best values for hyperparameters in order to produce the best performance for a model. To tune hyperparameters, grid search is commonly used. The procedure involves training a new model for each combination of hyperparameter values, evaluating each model, then selecting the hyperparameters that lead to the best model. If you are interested in learning more about hyperparameter tuning, refer to [14].</p>
<h4 id="model-training">Model training</h4>
<h5 id="constructing-the-dataset">Constructing the dataset</h5>
<p>To train the multi-task classification model, we first need to construct the dataset. The dataset comprises model inputs (features) and outputs (labels) that the model is expected to predict. To construct inputs, we process posts offline in batches and compute fused features as described earlier. These features can be stored in a feature store for future training. In order to create labels for each input, we have two options:</p>
<ul>
<li>Hand labeling</li>
<li>Natural labeling</li>
</ul>
<p>With hand labeling, human contractors label posts manually. This option produces accurate labels, but it is expensive and time-consuming. With natural labeling, we rely on user reports to label posts automatically. While this option results in noisier labels, labels are produced more quickly. For the evaluation dataset, we use hand labeling to prioritize the accuracy of labels, and for the training dataset, we use natural labeling to prioritize labeling speed. A data point from the constructed dataset is shown in Figure 5.16.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a simplified data pipeline for a content moderation system.  On the left, a dashed-line box labeled 'Post P' depicts a social media post containing user information (represented by a person icon and text fields) and multimedia content (a video camera icon and mountain icons, suggesting images or videos). This post data flows rightward via an arrow into a 'Feature preparation' block.  This block processes the post data, transforming it into a numerical feature vector. The output is a long horizontal rectangle labeled 'features,' representing the extracted features. Below this, another horizontal rectangle labeled 'label' shows a binary classification of the post based on five categories: nudity, illegal goods, violence, self-harm, and hate speech, each represented by a single cell containing a 0 (absence) or 1 (presence).  The arrangement shows the flow of information from raw post data through feature extraction to a final binary classification label for each category." loading="lazy" width="569" height="159" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(569px, 100vw), (max-width: 1200px) min(569px, 80vw), min(569px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-16-1-TXZGVSVN.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.16: A constructed data point</figcaption></div></figure></center>
<h5 id="choosing-the-loss-function">Choosing the loss function</h5>
<p>Training a multi-task neural network is very similar to how we typically train neural network models. A forward propagation performs computations to make a prediction, a loss function measures the correctness of the prediction, and a backward propagation optimizes the model's parameters to reduce the loss in the next iteration. Let's examine the loss function. In multi-task training, each task is assigned a loss function based on its ML category. In our case, each task is framed as a binary classification, so we adopt a standard binary classification loss such as cross-entropy for each task. The overall loss is computed by combining task-specific losses, as shown in Figure <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.17</mn></mrow><annotation encoding="application/x-tex">5.17</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.17</span></span></span></span>.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><div style="position: relative; width: 280px; height: 446px;"><img alt="Image represents a multi-task learning architecture for content moderation.  At the bottom, 'Fused features' (represented as a series of boxes) are fed into a 'Multi-task neural network'. This network outputs probabilities for different content categories: 'Violence probability' (0.89), 'Nudity probability' (0.1), and 'Hate probability' (0.7), representing the model's predictions for each category.  Each probability is associated with a loss value (L₁, L₂, Lₙ respectively), represented by boxes containing '1', '0', and '1' indicating whether the prediction is correct (1) or incorrect (0) for a given training example. These individual losses are then summed (L₁ + L₂ + ... + Lₙ) to calculate the total 'Loss', which is used to train the multi-task neural network through backpropagation.  The arrows indicate the flow of information, from features to predictions, and from predictions and their associated losses to the overall loss function.  The ellipsis (...) indicates that there are more than three categories and associated losses in the actual system." loading="lazy" width="280" height="446" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(280px, 100vw), (max-width: 1200px) min(280px, 80vw), min(280px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-17-1-TUCQRHJ4.png&amp;w=3840&amp;q=75" style="color: transparent;"></div></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.17: Model training</figcaption></div></figure></center>
<p>A common challenge in training multimodal systems is overfitting [15]. For example, when the learning speed varies across different modalities, one modality (e.g., image) can dominate the learning process. Two techniques to address this issue are gradient blending and focal loss. If you are interested in learning more about these techniques, refer to [16] [17].</p>
<h3 id="evaluation">Evaluation</h3>
<h4 id="offline-metrics">Offline metrics</h4>
<p>To evaluate the performance of a binary classification model, offline metrics such as precision, recall, and f1 score are commonly used. However, precision or recall alone is not sufficient to understand the overall performance. For example, a model with high precision might have a very low recall. The precision-recall (PR) curve and receiver operating characteristic (ROC) curve address those limitations. Let's explore each one.</p>
<p><strong>PR-curve.</strong> PR curve shows the trade-off between precision and recall of the model. As Figure <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.18</mn></mrow><annotation encoding="application/x-tex">5.18</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5.18</span></span></span></span> shows, we obtain a PR curve by plotting the precision of the model using different probability thresholds, ranging from 0 to 1 . To summarize the trade-offs between precision and recall, PR-AUC (the area under the precision-recall curve) calculates the area beneath the PR curve. In general, a high PR-AUC indicates a more accurate model.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a precision-recall curve, a common visualization in machine learning for evaluating the performance of a binary classification model.  The graph's x-axis represents Recall (the proportion of actual positives that were correctly identified), ranging from 0 to 1. The y-axis represents Precision (the proportion of predicted positives that were actually positive), also ranging from 0 to 1. The shaded area under the curve is light green, representing the Area Under the Curve (AUC), which is labeled within the shaded region. The curve itself starts at a precision of 1 and recall of 1, indicating perfect classification at the highest threshold, and then gradually decreases as recall increases, showing the trade-off between precision and recall at different classification thresholds.  The shape of the curve illustrates the model's ability to discriminate between positive and negative instances; a larger AUC indicates better performance." loading="lazy" width="406" height="266" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(406px, 100vw), (max-width: 1200px) min(406px, 80vw), min(406px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-18-1-AM4GN6NU.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.18: PR curve</figcaption></div></figure></center>
<p><strong>ROC curve.</strong> The ROC curve shows the trade-offs between the true positive rate (recall) and the false positive rate. Similar to the PR curve, ROC-AUC summarizes the model's performance by calculating the area under the ROC curve.</p>
<p>ROC and PR curves are two different ways to summarize the performance of a classification model. To learn about the differences between the PR curve and the ROC curve, read [18].</p>
<p>In our case, we use both ROC-AUC and PR-AUC as our offline metrics.</p>
<h4 id="online-metrics">Online metrics</h4>
<p>Let's explore a few important metrics to capture how safe the platform is.</p>
<p><strong>Prevalence.</strong> This metric measures the ratio of harmful posts which we didn't prevent and all posts on the platform.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>&nbsp;Prevalence&nbsp;</mtext><mo>=</mo><mfrac><mtext>&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;we&nbsp;didn’t&nbsp;prevent&nbsp;</mtext><mtext>&nbsp;Total&nbsp;number&nbsp;of&nbsp;posts&nbsp;on&nbsp;the&nbsp;platform&nbsp;</mtext></mfrac></mrow><annotation encoding="application/x-tex">\text { Prevalence }=\frac{\text { Number of harmful posts we didn't prevent }}{\text { Total number of posts on the platform }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord text"><span class="mord">&nbsp;Prevalence&nbsp;</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2519em; vertical-align: -0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">&nbsp;Total&nbsp;number&nbsp;of&nbsp;posts&nbsp;on&nbsp;the&nbsp;platform&nbsp;</span></span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;we&nbsp;didn’t&nbsp;prevent&nbsp;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>The shortcoming of this metric is that it treats harmful posts equally. For example, one harmful post with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mtext>&nbsp;</mtext><mi mathvariant="normal">K</mi></mrow></mrow><annotation encoding="application/x-tex">100 \mathrm{~K}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">100</span><span class="mord"><span class="mspace nobreak">&nbsp;</span><span class="mord mathrm">K</span></span></span></span></span> views or impressions is more harmful than two posts with 10 views each.</p>
<p><strong>Harmful impressions.</strong> We prefer this metric over prevalence. The reason is that the number of harmful posts on the platform does not show how many people were affected by those posts, whereas the number of harmful impressions does capture this information.</p>
<p><strong>Valid appeals.</strong> Percentage of posts that were deemed harmful, but
appealed and reversed.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>&nbsp;Appeals&nbsp;</mtext><mo>=</mo><mfrac><mtext>&nbsp;Number&nbsp;of&nbsp;reversed&nbsp;appeals&nbsp;</mtext><mtext>&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;detected&nbsp;by&nbsp;the&nbsp;system&nbsp;</mtext></mfrac></mrow><annotation encoding="application/x-tex">\text { Appeals }=\frac{\text { Number of reversed appeals }}{\text { Number of harmful posts detected by the system }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord text"><span class="mord">&nbsp;Appeals&nbsp;</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2519em; vertical-align: -0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;detected&nbsp;by&nbsp;the&nbsp;system&nbsp;</span></span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">&nbsp;Number&nbsp;of&nbsp;reversed&nbsp;appeals&nbsp;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p><strong>Proactive rate.</strong> Percentage of harmful posts found and deleted by the system before users report it.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>&nbsp;Proactive&nbsp;rate&nbsp;</mtext><mo>=</mo><mfrac><mtext>&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;detected&nbsp;by&nbsp;the&nbsp;system&nbsp;</mtext><mrow><mtext>&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;detected&nbsp;by&nbsp;the&nbsp;system&nbsp;</mtext><mo>+</mo><mtext>&nbsp;reported&nbsp;by&nbsp;users&nbsp;</mtext></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text { Proactive rate }=\frac{\text { Number of harmful posts detected by the system }}{\text { Number of harmful posts detected by the system }+\text { reported by users }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord text"><span class="mord">&nbsp;Proactive&nbsp;rate&nbsp;</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2519em; vertical-align: -0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;detected&nbsp;by&nbsp;the&nbsp;system&nbsp;</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord text"><span class="mord">&nbsp;reported&nbsp;by&nbsp;users&nbsp;</span></span></span></span><span style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">&nbsp;Number&nbsp;of&nbsp;harmful&nbsp;posts&nbsp;detected&nbsp;by&nbsp;the&nbsp;system&nbsp;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p><strong>User reports per harmful class.</strong> This metric measures the system's performance by looking into user reports for each harmful class.</p>
<h3 id="serving">Serving</h3>
<p>Figure 5.19 shows the high-level ML system design. Let’s take a closer look at each
component.</p>
<center><figure class="py-1"><div style="display: flex; justify-content: center;"><img alt="Image represents a system for detecting harmful content.  A user (represented by a person icon) uploads posts and comments (containing `post_info`, `post_id`, and `text`) to an `Application`. The application forwards this data to a `Harmful content detection service`, which uses a `Trained ML model` and data preprocessed by a `Feature preparation` service to analyze the content.  If the model detects harm with low confidence, the information is sent to a `Demoting service`, which then sends the post to a database labeled 'Posts that need manual review'. If the model detects harm with high confidence, the information is sent to a `Violation enforcement service` for immediate action.  The entire system is designed to filter harmful content, with low-confidence cases flagged for human review and high-confidence cases handled automatically." loading="lazy" width="653" height="349" decoding="async" data-nimg="1" sizes="(max-width: 840px) min(653px, 100vw), (max-width: 1200px) min(653px, 80vw), min(653px, 80vw)" srcset="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=640&amp;q=75 640w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=750&amp;q=75 750w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=828&amp;q=75 828w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=1080&amp;q=75 1080w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=1200&amp;q=75 1200w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=1920&amp;q=75 1920w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=2048&amp;q=75 2048w, https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=3840&amp;q=75 3840w" src="https://bytebytego.com/_next/image?url=%2Fimages%2Fcourses%2Fmachine-learning-system-design-interview%2Fharmful-content-detection%2Fch5-19-1-AXVUQWD5.png&amp;w=3840&amp;q=75" style="color: transparent;"></div><div style="display: flex; justify-content: center;"><figcaption class="py-1">Figure 5.19: ML system design</figcaption></div></figure></center>
<h4 id="harmful-content-detection-service">Harmful content detection service</h4>
<p>Given a new post, this service predicts the probability of harm. According to the requirements, some types of harm should be handled immediately due to their sensitivity. When this happens, the violation enforcement service removes the post immediately.</p>
<h4 id="violation-enforcement-service">Violation enforcement service</h4>
<p>The violation enforcement service immediately takes down a post if the harmful content detection service predicts harm with high confidence. It also notifies the user why the post was removed.</p>
<h4 id="demoting-service">Demoting service</h4>
<p>If the harmful content detection service predicts harm with low confidence, the demoting service temporarily demotes the post in order to decrease the chance of it spreading among users.</p>
<p>Then, the post is stored in storage for manual review by humans. The review team manually reviews the post and assigns a label from one of the predefined classes of harm. We will use these labeled posts in future training iterations to improve the model.</p>
<h4 id="other-talking-points">Other Talking Points</h4>
<ul>
<li>Handle biases introduced by human labeling [19].</li>
<li>Adapt the system to detect trending harmful classes (e.g., Covid-19, elections) [20].</li>
<li>How to build a harmful content detection system that leverages temporal information such as users' sequence of actions [21][22].</li>
<li>How to effectively select post samples for human review [23].</li>
<li>How to detect authentic and fake accounts [24].</li>
<li>How to deal with borderline contents [25], i.e., types of content that are not prohibited by guidelines, but come close to the red lines drawn by those policies.</li>
<li>How to make the harmful content detection system efficient, so we can deploy it on-device [26].</li>
<li>How to substitute Transformer-based architectures with linear Transformers to create a more efficient system [27] [28].</li>
</ul>
<h3 id="references">References</h3>
<ol>
<li>Facebook’s inauthentic behavior. <a href="https://transparency.fb.com/policies/community-standards/inauthentic-behavior/" target="_blank" rel="noopener noreferrer">https://transparency.fb.com/policies/community-standards/inauthentic-behavior/</a>.</li>
<li>LinkedIn’s professional community policies. <a href="https://www.linkedin.com/legal/professional-community-policies" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/legal/professional-community-policies</a>.</li>
<li>Twitter’s civic integrity policy. <a href="https://help.twitter.com/en/rules-and-policies/election-integrity-policy" target="_blank" rel="noopener noreferrer">https://help.twitter.com/en/rules-and-policies/election-integrity-policy</a>.</li>
<li>Facebook’s integrity survey. <a href="https://arxiv.org/pdf/2009.10311.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/2009.10311.pdf</a>.</li>
<li>Pinterest’s violation detection system. <a href="https://medium.com/pinterest-engineering/how-pinterest-fights-misinformation-hate-speech-and-self-harm-content-with-machine-learning-1806b73b40ef" target="_blank" rel="noopener noreferrer">https://medium.com/pinterest-engineering/how-pinterest-fights-misinformation-hate-speech-and-self-harm-content-with-machine-learning-1806b73b40ef</a>.</li>
<li>Abusive detection at LinkedIn. <a href="https://engineering.linkedin.com/blog/2019/isolation-forest" target="_blank" rel="noopener noreferrer">https://engineering.linkedin.com/blog/2019/isolation-forest</a>.</li>
<li>WPIE method. <a href="https://ai.facebook.com/blog/community-standards-report/" target="_blank" rel="noopener noreferrer">https://ai.facebook.com/blog/community-standards-report/</a>.</li>
<li>BERT paper. <a href="https://arxiv.org/pdf/1810.04805.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/1810.04805.pdf</a>.</li>
<li>Multilingual DistilBERT. <a href="https://huggingface.co/distilbert-base-multilingual-cased" target="_blank" rel="noopener noreferrer">https://huggingface.co/distilbert-base-multilingual-cased</a>.</li>
<li>Multilingual language models. <a href="https://arxiv.org/pdf/2107.00676.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/2107.00676.pdf</a>.</li>
<li>CLIP model. <a href="https://openai.com/blog/clip/" target="_blank" rel="noopener noreferrer">https://openai.com/blog/clip/</a>.</li>
<li>SimCLR paper. <a href="https://arxiv.org/pdf/2002.05709.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/2002.05709.pdf</a>.</li>
<li>VideoMoCo paper. <a href="https://arxiv.org/pdf/2103.05905.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/2103.05905.pdf</a>.</li>
<li>Hyperparameter tuning. <a href="https://cloud.google.com/ai-platform/training/docs/hyperparameter-tuning-overview" target="_blank" rel="noopener noreferrer">https://cloud.google.com/ai-platform/training/docs/hyperparameter-tuning-overview</a>.</li>
<li>Overfitting. <a href="https://en.wikipedia.org/wiki/Overfitting" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Overfitting</a>.</li>
<li>Focal loss. <a href="https://amaarora.github.io/posts/2020-06-29-FocalLoss.html" target="_blank" rel="noopener noreferrer">https://amaarora.github.io/posts/2020-06-29-FocalLoss.html</a>.</li>
<li>Gradient blending in multimodal systems. <a href="https://arxiv.org/pdf/1905.12681.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/1905.12681.pdf</a>.</li>
<li>ROC curve vs precision-recall curve. <a href="https://machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-classification-in-python/" target="_blank" rel="noopener noreferrer">https://machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-classification-in-python/</a>.</li>
<li>Introduced bias by human labeling. <a href="https://labelyourdata.com/articles/bias-in-machine-learning" target="_blank" rel="noopener noreferrer">https://labelyourdata.com/articles/bias-in-machine-learning</a>.</li>
<li>Facebook’s approach to quickly tackling trending harmful content. <a href="https://ai.facebook.com/blog/harmful-content-can-evolve-quickly-our-new-ai-system-adapts-to-tackle-it/" target="_blank" rel="noopener noreferrer">https://ai.facebook.com/blog/harmful-content-can-evolve-quickly-our-new-ai-system-adapts-to-tackle-it/</a>.</li>
<li>Facebook’s TIES approach. <a href="https://arxiv.org/pdf/2002.07917.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/2002.07917.pdf</a>.</li>
<li>Temporal interaction embedding. <a href="https://www.facebook.com/atscaleevents/videos/730968530723238/" target="_blank" rel="noopener noreferrer">https://www.facebook.com/atscaleevents/videos/730968530723238/</a>.</li>
<li>Building and scaling human review system. <a href="https://www.facebook.com/atscaleevents/videos/1201751883328695/" target="_blank" rel="noopener noreferrer">https://www.facebook.com/atscaleevents/videos/1201751883328695/</a>.</li>
<li>Abusive account detection framework. <a href="https://www.youtube.com/watch?v=YeX4MdU0JNk" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=YeX4MdU0JNk</a>.</li>
<li>Borderline contents. <a href="https://transparency.fb.com/features/approach-to-ranking/content-distribution-guidelines/content-borderline-to-the-community-standards/" target="_blank" rel="noopener noreferrer">https://transparency.fb.com/features/approach-to-ranking/content-distribution-guidelines/content-borderline-to-the-community-standards/</a>.</li>
<li>Efficient harmful content detection. <a href="https://about.fb.com/news/2021/12/metas-new-ai-system-tackles-harmful-content/" target="_blank" rel="noopener noreferrer">https://about.fb.com/news/2021/12/metas-new-ai-system-tackles-harmful-content/</a>.</li>
<li>Linear Transformer paper. <a href="https://arxiv.org/pdf/2006.04768.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/2006.04768.pdf</a>.</li>
<li>Efficient AI models to detect hate speech. <a href="https://ai.facebook.com/blog/how-facebook-uses-super-efficient-ai-models-to-detect-hate-speech/" target="_blank" rel="noopener noreferrer">https://ai.facebook.com/blog/how-facebook-uses-super-efficient-ai-models-to-detect-hate-speech/</a>.</li>
</ol>
        </article>
    </main>

    <div class="nav">
        <a href="../machine-learning-system-design-interview.html">← Course Contents</a>
        <a href="youtube-video-search.html">← Previous</a>
        <a href="video-recommendation-system.html">Next →</a>
    </div>

    <footer class="metadata">
        <p>Scraped on 10/10/2025</p>
    </footer>
</body>
</html>